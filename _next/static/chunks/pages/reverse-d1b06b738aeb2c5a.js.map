{"version":3,"file":"static/chunks/pages/reverse-d1b06b738aeb2c5a.js","mappings":"AEACA,CAAAA,KAAK,gBAAmB,CAAGA,KAAK,gBAAmB,EAAI,EAAE,EAAEC,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,CAEjE,KACC,SAASC,uBAAuB,CAAEC,wBAAwB,CAAEC,mBAAmB,CAAE,CFDxF,CAAAC,OAAAC,QAAA,CAAAD,OAAAC,QAAA,MAAAL,IAAA,EACA,WACA,UAAe,CACf,OAAAG,oBAAA,KACA,EACA,CAKA,gBAAAF,uBAAA,CAAAK,mBAAA,CAAAH,mBAAA,eAAAA,oBAAAI,CAAA,CAAAD,qBAAA,IAAAE,+CAAAL,oBAAA,MAAAM,4CAAAN,oBAAA,MAAAO,qDAAAP,oBAAA,MAAAQ,kCAAAR,oBAAA,MAAAS,6CAAAT,oBAAA,MCZAU,oCAAAV,oBAAA,MAOiC,IAC7BW,MAAO,GAAAH,kCAAAI,EAAA,GACXC,IAAA,KAEmD,GAAAL,kCAClCM,EAAA,MAAAJ,oCAAAK,CAAA,CAAAC,MAAA,OAAAA,QAAA,CACTA,SAIJ,MAAMA,OAAOC,OAAO,CAACC,MAAI,aAAYC,KAAA,KAAY,IAAU,MACvDH,OAAAC,OAAA,CAAAG,GAAA,gCAAkB,GAAAZ,kCAC2Ba,CAAA,EAAO,KACpDV,MAAAE,GAAA,CAAAhB,IAAA,oBAAAyB,MAAA,CAAAC,OAAAC,OAAA,EACA,GAA0CD,OACtCE,QAAO,CAAAC,MAAS,KAAAnB,qDAAAoB,EAAA,EACZ,MAAAC,MAAA,CAAkB,GAAApB,kCAC6Ba,CAAA,MAAsB,CACrEV,MAAAE,GAAA,CAAAhB,IAAA,cAAAyB,MAAA,CAAAC,OAAAC,OAAA,OAAAF,MAAA,IAAAhB,4CAAAuB,EAAA,EAAAD,QACJ,EACJ,CAEA,IAEJ,KACD,GAAwBE,gBAAA,EAE3B,GAA0C,IACtCC,kBACI,IACW,GAAI1B,+CACP2B,GAAA,SAACC,SAAAtB,MAAAE,GAAiB,CAAAqB,GAAA,EAAAC,KAAAC,QAAA,GAAA/B,+CAAA2B,GAAA,SAARC,SAAAE,IAAA,EAAAC,OAI1B,EAE2CjC,CAAAA,oBAAA,WAAAM,6CAAA4B,EAAA,EAAAN,kBAAA,YAAA/B,mBAAA,EAAAA,oBAAAsC,CAAA,mCAAAtC,oBAAAA,oBAAAuC,CAAA,SAAAC,KAAAxC,oBAAAsC,CAAA","sources":["webpack://_N_E/?ef2b","webpack://_N_E/./src/pages/reverse.tsx","webpack://_N_E/<anon>"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/reverse\",\n      function () {\n        return require(\"private-next-pages/reverse.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/reverse\"])\n      });\n    }\n  ","import { decodeUtf8 } from \"@yume-chan/adb\";\nimport { WritableStream } from '@yume-chan/stream-extra';\nimport { makeAutoObservable, reaction, runInAction } from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport { NextPage } from \"next\";\nimport { GlobalState } from \"../state\";\n\nconst state = makeAutoObservable({\n    log: [] as string[],\n});\n\nreaction(() => GlobalState.device, async device => {\n    if (!device) {\n        return;\n    }\n\n    await device.reverse.remove('tcp:3000').catch(() => { });\n    await device.reverse.add('tcp:3000', 'tcp:1234', socket => {\n        runInAction(() => {\n            state.log.push(`received stream ${socket.localId}`);\n        });\n        socket.readable.pipeTo(new WritableStream({\n            write: chunk => {\n                runInAction(() => {\n                    state.log.push(`data from ${socket.localId}: ${decodeUtf8(chunk)}`);\n                });\n            }\n        }));\n\n        // Return true to accept the connection.\n        return true;\n    });\n}, { fireImmediately: true });\n\nconst ReverseTesterPage: NextPage = () => {\n    return (\n        <div>\n            {state.log.map((line, index) => (\n                <div key={index}>{line}</div>\n            ))}\n        </div>\n    );\n};\n\nexport default observer(ReverseTesterPage);\n","(self[\"webpackChunk_N_E\"] = self[\"webpackChunk_N_E\"] || []).push([[27],{\n\n/***/ 1989:\n/***/ (function(__unused_webpack_module, __unused_webpack_exports, __webpack_require__) {\n\n\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/reverse\",\n      function () {\n        return __webpack_require__(8548);\n      }\n    ]);\n    if(false) {}\n  \n\n/***/ }),\n\n/***/ 8548:\n/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(4471);\n/* harmony import */ var _yume_chan_adb__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(7417);\n/* harmony import */ var _yume_chan_stream_extra__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(6261);\n/* harmony import */ var mobx__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(6323);\n/* harmony import */ var mobx_react_lite__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(6779);\n/* harmony import */ var _state__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(2344);\n\n\n\n\n\n\nconst state = (0,mobx__WEBPACK_IMPORTED_MODULE_5__/* .makeAutoObservable */ .ky)({\n    log: []\n});\n(0,mobx__WEBPACK_IMPORTED_MODULE_5__/* .reaction */ .U5)(()=>_state__WEBPACK_IMPORTED_MODULE_4__/* .GlobalState.device */ .q.device, async (device)=>{\n    if (!device) {\n        return;\n    }\n    await device.reverse.remove(\"tcp:3000\").catch(()=>{});\n    await device.reverse.add(\"tcp:3000\", \"tcp:1234\", (socket)=>{\n        (0,mobx__WEBPACK_IMPORTED_MODULE_5__/* .runInAction */ .z)(()=>{\n            state.log.push(\"received stream \".concat(socket.localId));\n        });\n        socket.readable.pipeTo(new _yume_chan_stream_extra__WEBPACK_IMPORTED_MODULE_2__/* .WritableStream */ .Vj({\n            write: (chunk)=>{\n                (0,mobx__WEBPACK_IMPORTED_MODULE_5__/* .runInAction */ .z)(()=>{\n                    state.log.push(\"data from \".concat(socket.localId, \": \").concat((0,_yume_chan_adb__WEBPACK_IMPORTED_MODULE_1__/* .decodeUtf8 */ .FO)(chunk)));\n                });\n            }\n        }));\n        // Return true to accept the connection.\n        return true;\n    });\n}, {\n    fireImmediately: true\n});\nconst ReverseTesterPage = ()=>{\n    return /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\n        children: state.log.map((line, index)=>/*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\n                children: line\n            }, index))\n    });\n};\n/* harmony default export */ __webpack_exports__[\"default\"] = ((0,mobx_react_lite__WEBPACK_IMPORTED_MODULE_3__/* .observer */ .Pi)(ReverseTesterPage));\n\n\n/***/ })\n\n},\n/******/ function(__webpack_require__) { // webpackRuntimeModules\n/******/ var __webpack_exec__ = function(moduleId) { return __webpack_require__(__webpack_require__.s = moduleId); }\n/******/ __webpack_require__.O(0, [774,888,179], function() { return __webpack_exec__(1989); });\n/******/ var __webpack_exports__ = __webpack_require__.O();\n/******/ _N_E = __webpack_exports__;\n/******/ }\n]);"],"names":["self","push","__unused_webpack_module","__unused_webpack_exports","__webpack_require__","window","__NEXT_P","__webpack_exports__","r","react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__","_yume_chan_adb__WEBPACK_IMPORTED_MODULE_1__","_yume_chan_stream_extra__WEBPACK_IMPORTED_MODULE_2__","mobx__WEBPACK_IMPORTED_MODULE_5__","mobx_react_lite__WEBPACK_IMPORTED_MODULE_3__","_state__WEBPACK_IMPORTED_MODULE_4__","state","ky","log","U5","q","device","reverse","remove","catch","add","z","concat","socket","localId","readable","pipeTo","Vj","chunk","FO","fireImmediately","ReverseTesterPage","jsx","children","map","line","index","Pi","O","s","_N_E"],"sourceRoot":""}