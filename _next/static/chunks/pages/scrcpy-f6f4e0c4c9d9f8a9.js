(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[533],{7452:function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){(window.__NEXT_P=window.__NEXT_P||[]).push(["/scrcpy",function(){return __webpack_require__(1492)}])},1492:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";let worker,cachedInitializePromise,cachedValue;__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return scrcpy}});var ScrcpyControlMessageType,AndroidKeyEventAction,AndroidKeyCode,AndroidMotionEventAction,AndroidScreenPowerMode,ScrcpyDeviceMessageType,ScrcpyLogLevel,ScrcpyVideoOrientation,AndroidCodecProfile,AndroidCodecLevel,ScrcpyControlMessageType1,AndroidKeyEventAction1,AndroidKeyCode1,AndroidMotionEventAction1,AndroidScreenPowerMode1,ScrcpyDeviceMessageType1,ScrcpyLogLevel1,ScrcpyVideoOrientation1,AndroidCodecProfile1,AndroidCodecLevel1,jsx_runtime=__webpack_require__(4471),Stack=__webpack_require__(1887),TooltipHost=__webpack_require__(5169),Icon=__webpack_require__(8415),TextField=__webpack_require__(2081),Dropdown=__webpack_require__(706),Toggle=__webpack_require__(7738),SpinButton=__webpack_require__(1818),positioning_types=__webpack_require__(638),IconButton=__webpack_require__(1197),tslib_es6=__webpack_require__(3499),react=__webpack_require__(3370),useUnmount=__webpack_require__(1344),getId=__webpack_require__(5561),css=__webpack_require__(6799),Layer_notification=__webpack_require__(4619),LayerHost=function(props){var className=props.className,layerHostId=react.useState(function(){return(0,getId.z)()})[0],_a=props.id,hostId=void 0===_a?layerHostId:_a,layerHostRef=react.useRef({hostId:hostId,rootRef:react.useRef(null),notifyLayersChanged:function(){}});return react.useImperativeHandle(props.componentRef,function(){return layerHostRef.current}),react.useEffect(function(){(0,Layer_notification._Y)(hostId,layerHostRef.current),(0,Layer_notification.EQ)(hostId)},[]),(0,useUnmount.k)(function(){(0,Layer_notification.nw)(hostId,layerHostRef.current),(0,Layer_notification.EQ)(hostId)}),react.createElement("div",(0,tslib_es6.pi)({},props,{className:(0,css.i)("ms-LayerHost",className),ref:layerHostRef.current.rootRef}))},Dialog=__webpack_require__(6335),ProgressIndicator=__webpack_require__(7520),CommandBar=__webpack_require__(9426),useId=__webpack_require__(4976),makeStyles_esm=__webpack_require__(9332),mobx_esm=__webpack_require__(6323),es=__webpack_require__(6779),head=__webpack_require__(3591),head_default=__webpack_require__.n(head),esm=__webpack_require__(7417),event_esm=__webpack_require__(2469),async_esm=__webpack_require__(6789),stream_extra_esm=__webpack_require__(6261);class AdbScrcpyConnection{adb;options;constructor(adb,options){this.adb=adb,this.options=options}initialize(){}dispose(){}}class AdbScrcpyForwardConnection extends AdbScrcpyConnection{connect(){return this.adb.createSocket("localabstract:scrcpy")}async connectAndRetry(){for(let i=0;i<100;i++)try{return await this.connect()}catch(e){await (0,async_esm.gw)(100)}throw Error("Can't connect to server after 100 retries")}async connectVideoStream(){let{readable:videoStream}=await this.connectAndRetry();if(this.options.sendDummyByte){let reader=videoStream.getReader(),{done,value}=await reader.read();if(done||1!==value.byteLength||0!==value[0])throw Error("Unexpected response from server");reader.releaseLock()}return videoStream}async getStreams(){let controlStream;let videoStream=await this.connectVideoStream();if(this.options.control&&(controlStream=await this.connectAndRetry()),this.options.sendDeviceMeta){let reader=videoStream.getReader(),{done,value}=await reader.read();if(done||68!==value.byteLength)throw Error("Unexpected response from server");reader.releaseLock()}return[videoStream,controlStream]}}class AdbScrcpyReverseConnection extends AdbScrcpyConnection{streams;address;async initialize(){await this.adb.reverse.remove("localabstract:scrcpy").catch(()=>{});let queue=new stream_extra_esm.GJ;this.streams=queue.readable.getReader();let writer=queue.writable.getWriter();this.address=await this.adb.reverse.add("localabstract:scrcpy","tcp:27183",socket=>(writer.write(socket),!0))}async accept(){return(await this.streams.read()).value}async getStreams(){let controlStream;let{readable:videoStream}=await this.accept();if(this.options.control&&(controlStream=await this.accept()),this.options.sendDeviceMeta){let reader=videoStream.getReader(),{done,value}=await reader.read();if(done||68!==value.byteLength)throw Error("Unexpected response from server");reader.releaseLock()}return[videoStream,controlStream]}dispose(){this.adb.reverse.remove(this.address)}}class AdbScrcpyOptionsBase{raw;get value(){return this.raw.value}set value(value){this.raw.value=value}constructor(raw){this.raw=raw}getDefaultValue(){return this.raw.getDefaultValue()}formatServerArguments(){return this.raw.formatServerArguments()}getOutputEncoderNameRegex(){return this.raw.getOutputEncoderNameRegex()}createVideoStreamTransformer(){return this.raw.createVideoStreamTransformer()}getControlMessageTypes(){return this.raw.getControlMessageTypes()}serializeBackOrScreenOnControlMessage(message){return this.raw.serializeBackOrScreenOnControlMessage(message)}serializeInjectScrollControlMessage(message){return this.raw.serializeInjectScrollControlMessage(message)}}class AdbScrcpyOptions1_16 extends AdbScrcpyOptionsBase{createConnection(adb){let options={control:!0,sendDummyByte:!0,sendDeviceMeta:!0};return this.value.tunnelForward?new AdbScrcpyForwardConnection(adb,options):new AdbScrcpyReverseConnection(adb,options)}}class AdbScrcpyOptions1_22 extends AdbScrcpyOptions1_16{createConnection(adb){let options={...this.getDefaultValue(),...this.value};return this.value.tunnelForward?new AdbScrcpyForwardConnection(adb,options):new AdbScrcpyReverseConnection(adb,options)}}var struct_esm=__webpack_require__(9229);(ScrcpyControlMessageType=ScrcpyControlMessageType1=ScrcpyControlMessageType1||(ScrcpyControlMessageType1={}))[ScrcpyControlMessageType.InjectKeyCode=0]="InjectKeyCode",ScrcpyControlMessageType[ScrcpyControlMessageType.InjectText=1]="InjectText",ScrcpyControlMessageType[ScrcpyControlMessageType.InjectTouch=2]="InjectTouch",ScrcpyControlMessageType[ScrcpyControlMessageType.InjectScroll=3]="InjectScroll",ScrcpyControlMessageType[ScrcpyControlMessageType.BackOrScreenOn=4]="BackOrScreenOn",ScrcpyControlMessageType[ScrcpyControlMessageType.ExpandNotificationPanel=5]="ExpandNotificationPanel",ScrcpyControlMessageType[ScrcpyControlMessageType.ExpandSettingPanel=6]="ExpandSettingPanel",ScrcpyControlMessageType[ScrcpyControlMessageType.CollapseNotificationPanel=7]="CollapseNotificationPanel",ScrcpyControlMessageType[ScrcpyControlMessageType.GetClipboard=8]="GetClipboard",ScrcpyControlMessageType[ScrcpyControlMessageType.SetClipboard=9]="SetClipboard",ScrcpyControlMessageType[ScrcpyControlMessageType.SetScreenPowerMode=10]="SetScreenPowerMode",ScrcpyControlMessageType[ScrcpyControlMessageType.RotateDevice=11]="RotateDevice",(AndroidKeyEventAction=AndroidKeyEventAction1=AndroidKeyEventAction1||(AndroidKeyEventAction1={}))[AndroidKeyEventAction.Down=0]="Down",AndroidKeyEventAction[AndroidKeyEventAction.Up=1]="Up",(AndroidKeyCode=AndroidKeyCode1=AndroidKeyCode1||(AndroidKeyCode1={}))[AndroidKeyCode.Home=3]="Home",AndroidKeyCode[AndroidKeyCode.Back=4]="Back",AndroidKeyCode[AndroidKeyCode.VolumeUp=24]="VolumeUp",AndroidKeyCode[AndroidKeyCode.VolumeDown=25]="VolumeDown",AndroidKeyCode[AndroidKeyCode.A=29]="A",AndroidKeyCode[AndroidKeyCode.B=30]="B",AndroidKeyCode[AndroidKeyCode.C=31]="C",AndroidKeyCode[AndroidKeyCode.D=32]="D",AndroidKeyCode[AndroidKeyCode.E=33]="E",AndroidKeyCode[AndroidKeyCode.F=34]="F",AndroidKeyCode[AndroidKeyCode.G=35]="G",AndroidKeyCode[AndroidKeyCode.H=36]="H",AndroidKeyCode[AndroidKeyCode.I=37]="I",AndroidKeyCode[AndroidKeyCode.J=38]="J",AndroidKeyCode[AndroidKeyCode.K=39]="K",AndroidKeyCode[AndroidKeyCode.L=40]="L",AndroidKeyCode[AndroidKeyCode.M=41]="M",AndroidKeyCode[AndroidKeyCode.N=42]="N",AndroidKeyCode[AndroidKeyCode.O=43]="O",AndroidKeyCode[AndroidKeyCode.P=44]="P",AndroidKeyCode[AndroidKeyCode.Q=45]="Q",AndroidKeyCode[AndroidKeyCode.R=46]="R",AndroidKeyCode[AndroidKeyCode.S=47]="S",AndroidKeyCode[AndroidKeyCode.T=48]="T",AndroidKeyCode[AndroidKeyCode.U=49]="U",AndroidKeyCode[AndroidKeyCode.V=50]="V",AndroidKeyCode[AndroidKeyCode.W=51]="W",AndroidKeyCode[AndroidKeyCode.X=52]="X",AndroidKeyCode[AndroidKeyCode.Y=53]="Y",AndroidKeyCode[AndroidKeyCode.Z=54]="Z",AndroidKeyCode[AndroidKeyCode.Tab=61]="Tab",AndroidKeyCode[AndroidKeyCode.Space=62]="Space",AndroidKeyCode[AndroidKeyCode.Enter=66]="Enter",AndroidKeyCode[AndroidKeyCode.Delete=67]="Delete",AndroidKeyCode[AndroidKeyCode.VolumeMute=164]="VolumeMute",AndroidKeyCode[AndroidKeyCode.AppSwitch=187]="AppSwitch";let ScrcpyInjectKeyCodeControlMessage=new struct_esm.ZP().uint8("type",ScrcpyControlMessageType1.InjectKeyCode).uint8("action",(0,struct_esm.W$)()).uint32("keyCode").uint32("repeat").uint32("metaState"),ScrcpyInjectTextControlMessage=new struct_esm.ZP().uint8("type",ScrcpyControlMessageType1.InjectText).uint32("length").string("text",{lengthField:"length"});(AndroidMotionEventAction=AndroidMotionEventAction1=AndroidMotionEventAction1||(AndroidMotionEventAction1={}))[AndroidMotionEventAction.Down=0]="Down",AndroidMotionEventAction[AndroidMotionEventAction.Up=1]="Up",AndroidMotionEventAction[AndroidMotionEventAction.Move=2]="Move",AndroidMotionEventAction[AndroidMotionEventAction.Cancel=3]="Cancel",AndroidMotionEventAction[AndroidMotionEventAction.Outside=4]="Outside",AndroidMotionEventAction[AndroidMotionEventAction.PointerDown=5]="PointerDown",AndroidMotionEventAction[AndroidMotionEventAction.PointerUp=6]="PointerUp",AndroidMotionEventAction[AndroidMotionEventAction.HoverMove=7]="HoverMove",AndroidMotionEventAction[AndroidMotionEventAction.Scroll=8]="Scroll",AndroidMotionEventAction[AndroidMotionEventAction.HoverEnter=9]="HoverEnter",AndroidMotionEventAction[AndroidMotionEventAction.HoverExit=10]="HoverExit",AndroidMotionEventAction[AndroidMotionEventAction.ButtonPress=11]="ButtonPress",AndroidMotionEventAction[AndroidMotionEventAction.ButtonRelease=12]="ButtonRelease";let ScrcpyInjectTouchControlMessage=new struct_esm.ZP().uint8("type",ScrcpyControlMessageType1.InjectTouch).uint8("action",(0,struct_esm.W$)()).uint64("pointerId").uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").uint16("pressure").uint32("buttons"),ScrcpyRotateDeviceControlMessage=new struct_esm.ZP().uint8("type",ScrcpyControlMessageType1.RotateDevice);(AndroidScreenPowerMode=AndroidScreenPowerMode1=AndroidScreenPowerMode1||(AndroidScreenPowerMode1={}))[AndroidScreenPowerMode.Off=0]="Off",AndroidScreenPowerMode[AndroidScreenPowerMode.Normal=2]="Normal";let ScrcpySetScreenPowerModeControlMessage=new struct_esm.ZP().uint8("type",ScrcpyControlMessageType1.SetScreenPowerMode).uint8("mode",(0,struct_esm.W$)());class ScrcpyControlMessageSerializer{options;types;writer;constructor(stream,options){this.options=options,this.types=options.getControlMessageTypes(),this.writer=stream.getWriter()}getTypeValue(type){let value=this.types.indexOf(type);if(-1===value)throw Error("Not supported");return value}injectKeyCode(message){return this.writer.write(ScrcpyInjectKeyCodeControlMessage.serialize({...message,type:this.getTypeValue(ScrcpyControlMessageType1.InjectKeyCode)}))}injectText(text){return this.writer.write(ScrcpyInjectTextControlMessage.serialize({text,type:this.getTypeValue(ScrcpyControlMessageType1.InjectText)}))}injectTouch(message){return this.writer.write(ScrcpyInjectTouchControlMessage.serialize({...message,type:this.getTypeValue(ScrcpyControlMessageType1.InjectTouch)}))}injectScroll(message){return this.writer.write(this.options.serializeInjectScrollControlMessage({...message,type:this.getTypeValue(ScrcpyControlMessageType1.InjectScroll)}))}async backOrScreenOn(action){let buffer=this.options.serializeBackOrScreenOnControlMessage({action,type:this.getTypeValue(ScrcpyControlMessageType1.BackOrScreenOn)});if(buffer)return await this.writer.write(buffer)}setScreenPowerMode(mode){return this.writer.write(ScrcpySetScreenPowerModeControlMessage.serialize({mode,type:this.getTypeValue(ScrcpyControlMessageType1.SetScreenPowerMode)}))}rotateDevice(){return this.writer.write(ScrcpyRotateDeviceControlMessage.serialize({type:this.getTypeValue(ScrcpyControlMessageType1.RotateDevice)}))}close(){return this.writer.close()}}(ScrcpyDeviceMessageType=ScrcpyDeviceMessageType1=ScrcpyDeviceMessageType1||(ScrcpyDeviceMessageType1={}))[ScrcpyDeviceMessageType.Clipboard=0]="Clipboard",ScrcpyDeviceMessageType[ScrcpyDeviceMessageType.AckClipboard=1]="AckClipboard";let ScrcpyClipboardDeviceMessage=new struct_esm.ZP().uint32("length").string("content",{lengthField:"length"}).extra({type:ScrcpyDeviceMessageType1.Clipboard});class ScrcpyDeviceMessageDeserializeStream extends stream_extra_esm.pC{constructor(){super(async stream=>{let type=await stream.read(1);if(0===type[0])return await ScrcpyClipboardDeviceMessage.deserialize(stream);throw Error("unknown control message type")})}}let CODEC_OPTION_TYPES={repeatPreviousFrameAfter:"long",maxPtsGapToEncoder:"long"};class CodecOptions{value;constructor(value){this.value=value}toOptionValue(){let entries=Object.entries(this.value).filter(([key,value])=>void 0!==value);if(0!==entries.length)return entries.map(([key,value])=>{let type=CODEC_OPTION_TYPES[key];return`${key.replace(/([A-Z])/g,"-$1").toLowerCase()}${type?`:${type}`:""}=${value}`}).join(",")}}let DEFAULT_SERVER_PATH="/data/local/tmp/scrcpy-server.jar";function toScrcpyOptionValue(value,empty){var value1;return"object"==typeof(value1=value)&&null!==value1&&"function"==typeof value1.toOptionValue&&(value=value.toOptionValue()),void 0===value?empty:`${value}`}class BitReader{buffer;bytePosition=0;bitPosition=0;constructor(buffer){this.buffer=buffer}read(length){let result=0;for(let i=0;i<length;i+=1)result=result<<1|this.next();return result}next(){let value=this.buffer[this.bytePosition]>>7-this.bitPosition&1;return this.bitPosition+=1,8===this.bitPosition&&(this.bytePosition+=1,this.bitPosition=0),value}decodeExponentialGolombNumber(){let length=0;for(;0===this.next();)length+=1;return 0===length?0:(1<<length|this.read(length))-1}}(ScrcpyLogLevel=ScrcpyLogLevel1=ScrcpyLogLevel1||(ScrcpyLogLevel1={})).Verbose="verbose",ScrcpyLogLevel.Debug="debug",ScrcpyLogLevel.Info="info",ScrcpyLogLevel.Warn="warn",ScrcpyLogLevel.Error="error",(ScrcpyVideoOrientation=ScrcpyVideoOrientation1=ScrcpyVideoOrientation1||(ScrcpyVideoOrientation1={}))[ScrcpyVideoOrientation.Initial=-2]="Initial",ScrcpyVideoOrientation[ScrcpyVideoOrientation.Unlocked=-1]="Unlocked",ScrcpyVideoOrientation[ScrcpyVideoOrientation.Portrait=0]="Portrait",ScrcpyVideoOrientation[ScrcpyVideoOrientation.Landscape=1]="Landscape",ScrcpyVideoOrientation[ScrcpyVideoOrientation.PortraitFlipped=2]="PortraitFlipped",ScrcpyVideoOrientation[ScrcpyVideoOrientation.LandscapeFlipped=3]="LandscapeFlipped";let VideoPacket=new struct_esm.ZP().uint64("pts").uint32("size").uint8Array("data",{lengthField:"size"}),NO_PTS=BigInt(1)<<BigInt(63),ScrcpyBackOrScreenOnControlMessage1_16=new struct_esm.ZP().uint8("type",ScrcpyControlMessageType1.BackOrScreenOn),ScrcpyInjectScrollControlMessage1_16=new struct_esm.ZP().uint8("type",ScrcpyControlMessageType1.InjectScroll).uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").int32("scrollX").int32("scrollY");class ScrcpyOptions1_16{value;constructor(value){new.target===ScrcpyOptions1_16&&value.logLevel===ScrcpyLogLevel1.Verbose&&(value.logLevel=ScrcpyLogLevel1.Debug),new.target===ScrcpyOptions1_16&&value.lockVideoOrientation===ScrcpyVideoOrientation1.Initial&&(value.lockVideoOrientation=ScrcpyVideoOrientation1.Unlocked),this.value=value}getArgumentOrder(){return["logLevel","maxSize","bitRate","maxFps","lockVideoOrientation","tunnelForward","crop","sendFrameMeta","control","displayId","showTouches","stayAwake","codecOptions","encoderName"]}getDefaultValue(){return{logLevel:ScrcpyLogLevel1.Debug,maxSize:0,bitRate:8e6,maxFps:0,lockVideoOrientation:ScrcpyVideoOrientation1.Unlocked,tunnelForward:!1,crop:"-",sendFrameMeta:!0,control:!0,displayId:0,showTouches:!1,stayAwake:!1,codecOptions:new CodecOptions({}),encoderName:"-"}}formatServerArguments(){let defaults=this.getDefaultValue();return this.getArgumentOrder().map(key=>toScrcpyOptionValue(this.value[key]||defaults[key],"-"))}getOutputEncoderNameRegex(){return/\s+scrcpy --encoder-name '(.*?)'/}createVideoStreamTransformer(){let header;if(!1===this.value.sendFrameMeta)return new stream_extra_esm.GJ({transform(chunk,controller){controller.enqueue({type:"frame",data:chunk})}});let deserializeStream=new stream_extra_esm.gL(VideoPacket);return{writable:deserializeStream.writable,readable:deserializeStream.readable.pipeThrough(new stream_extra_esm.GJ({transform(packet,controller){let frameData;if(packet.pts===NO_PTS){let sequenceParameterSet=function(buffer){for(let nalu of function*(buffer){let start=-1,writeIndex=0,zeroCount=0,inEmulation=!1;for(let byte of buffer){if(buffer[writeIndex]=byte,writeIndex+=1,inEmulation){if(byte>3)throw Error("Invalid data");inEmulation=!1;continue}if(0==byte){zeroCount+=1;continue}let lastZeroCount=zeroCount;if(zeroCount=0,-1===start){if(lastZeroCount>=2&&1===byte){writeIndex=0,start=0;continue}throw Error("Invalid data")}if(!(lastZeroCount<2)){if(1===byte){yield buffer.subarray(start,writeIndex-=lastZeroCount+1),start=writeIndex;continue}if(lastZeroCount>2)throw Error("Invalid data");switch(byte){case 2:throw Error("Invalid data");case 3:writeIndex-=1,inEmulation=!0}}}if(inEmulation||0!==zeroCount)throw Error("Invalid data");yield buffer.subarray(start,writeIndex)}(new Uint8Array(buffer))){let frame_crop_left_offset,frame_crop_right_offset,frame_crop_top_offset,frame_crop_bottom_offset;let reader=new BitReader(nalu);if(0!==reader.next())break;let nal_ref_idc=reader.read(2),nal_unit_type=reader.read(5);if(7!==nal_unit_type)continue;if(0===nal_ref_idc)break;let profile_idc=reader.read(8),constraint_set=reader.read(8),constraint_set_reader=new BitReader(new Uint8Array([constraint_set])),constraint_set0_flag=!!constraint_set_reader.next(),constraint_set1_flag=!!constraint_set_reader.next(),constraint_set2_flag=!!constraint_set_reader.next(),constraint_set3_flag=!!constraint_set_reader.next(),constraint_set4_flag=!!constraint_set_reader.next(),constraint_set5_flag=!!constraint_set_reader.next();if(0!==constraint_set_reader.read(2))break;let level_idc=reader.read(8),seq_parameter_set_id=reader.decodeExponentialGolombNumber();if(100===profile_idc||110===profile_idc||122===profile_idc||244===profile_idc||44===profile_idc||83===profile_idc||86===profile_idc||118===profile_idc||128===profile_idc||138===profile_idc||139===profile_idc||134===profile_idc){let chroma_format_idc=reader.decodeExponentialGolombNumber();3===chroma_format_idc&&reader.next(),reader.decodeExponentialGolombNumber(),reader.decodeExponentialGolombNumber(),reader.next();let seq_scaling_matrix_present_flag=!!reader.next();if(seq_scaling_matrix_present_flag){let seq_scaling_list_present_flag=[];for(let i=0;i<(3!==chroma_format_idc?8:12);i++)seq_scaling_list_present_flag[i]=!!reader.next(),seq_scaling_list_present_flag[i]}}reader.decodeExponentialGolombNumber();let pic_order_cnt_type=reader.decodeExponentialGolombNumber();if(0===pic_order_cnt_type)reader.decodeExponentialGolombNumber();else if(1===pic_order_cnt_type){reader.next(),reader.decodeExponentialGolombNumber(),reader.decodeExponentialGolombNumber();let num_ref_frames_in_pic_order_cnt_cycle=reader.decodeExponentialGolombNumber(),offset_for_ref_frame=[];for(let i1=0;i1<num_ref_frames_in_pic_order_cnt_cycle;i1++)offset_for_ref_frame[i1]=reader.decodeExponentialGolombNumber()}reader.decodeExponentialGolombNumber(),reader.next();let pic_width_in_mbs_minus1=reader.decodeExponentialGolombNumber(),pic_height_in_map_units_minus1=reader.decodeExponentialGolombNumber(),frame_mbs_only_flag=reader.next();frame_mbs_only_flag||reader.next(),reader.next();let frame_cropping_flag=!!reader.next();return frame_cropping_flag?(frame_crop_left_offset=reader.decodeExponentialGolombNumber(),frame_crop_right_offset=reader.decodeExponentialGolombNumber(),frame_crop_top_offset=reader.decodeExponentialGolombNumber(),frame_crop_bottom_offset=reader.decodeExponentialGolombNumber()):(frame_crop_left_offset=0,frame_crop_right_offset=0,frame_crop_top_offset=0,frame_crop_bottom_offset=0),reader.next(),{profile_idc,constraint_set,constraint_set0_flag,constraint_set1_flag,constraint_set2_flag,constraint_set3_flag,constraint_set4_flag,constraint_set5_flag,level_idc,seq_parameter_set_id,pic_width_in_mbs_minus1,pic_height_in_map_units_minus1,frame_mbs_only_flag,frame_cropping_flag,frame_crop_left_offset,frame_crop_right_offset,frame_crop_top_offset,frame_crop_bottom_offset}}throw Error("Invalid data")}(packet.data.slice().buffer),{profile_idc:profileIndex,constraint_set:constraintSet,level_idc:levelIndex,pic_width_in_mbs_minus1,pic_height_in_map_units_minus1,frame_mbs_only_flag,frame_crop_left_offset,frame_crop_right_offset,frame_crop_top_offset,frame_crop_bottom_offset}=sequenceParameterSet,encodedWidth=(pic_width_in_mbs_minus1+1)*16,encodedHeight=(pic_height_in_map_units_minus1+1)*(2-frame_mbs_only_flag)*16,cropLeft=2*frame_crop_left_offset,cropRight=2*frame_crop_right_offset,cropTop=2*frame_crop_top_offset,cropBottom=2*frame_crop_bottom_offset;header=packet.data,controller.enqueue({type:"configuration",data:{profileIndex,constraintSet,levelIndex,encodedWidth,encodedHeight,cropLeft,cropRight,cropTop,cropBottom,croppedWidth:encodedWidth-cropLeft-cropRight,croppedHeight:encodedHeight-cropTop-cropBottom}});return}header?((frameData=new Uint8Array(header.byteLength+packet.data.byteLength)).set(header),frameData.set(packet.data,header.byteLength),header=void 0):frameData=packet.data,controller.enqueue({type:"frame",pts:packet.pts,data:frameData})}}))}}getControlMessageTypes(){return[ScrcpyControlMessageType1.InjectKeyCode,ScrcpyControlMessageType1.InjectText,ScrcpyControlMessageType1.InjectTouch,ScrcpyControlMessageType1.InjectScroll,ScrcpyControlMessageType1.BackOrScreenOn,ScrcpyControlMessageType1.ExpandNotificationPanel,ScrcpyControlMessageType1.CollapseNotificationPanel,ScrcpyControlMessageType1.GetClipboard,ScrcpyControlMessageType1.SetClipboard,ScrcpyControlMessageType1.SetScreenPowerMode,ScrcpyControlMessageType1.RotateDevice]}serializeBackOrScreenOnControlMessage(message){if(message.action===AndroidKeyEventAction1.Down)return ScrcpyBackOrScreenOnControlMessage1_16.serialize(message)}serializeInjectScrollControlMessage(message){return ScrcpyInjectScrollControlMessage1_16.serialize(message)}}let ScrcpyBackOrScreenOnControlMessage1_18=new struct_esm.ZP().fields(ScrcpyBackOrScreenOnControlMessage1_16).uint8("action",(0,struct_esm.W$)());class ScrcpyOptions1_18 extends ScrcpyOptions1_16{constructor(value){super(value)}getArgumentOrder(){return super.getArgumentOrder().concat(["powerOffOnClose"])}getDefaultValue(){return{...super.getDefaultValue(),powerOffOnClose:!1}}getOutputEncoderNameRegex(){return/\s+scrcpy --encoder '(.*?)'/}getControlMessageTypes(){let types=super.getControlMessageTypes();return types.splice(6,0,ScrcpyControlMessageType1.ExpandSettingPanel),types}serializeBackOrScreenOnControlMessage(message){return ScrcpyBackOrScreenOnControlMessage1_18.serialize(message)}}class ScrcpyOptions1_21 extends ScrcpyOptions1_18{constructor(init){super(init)}getDefaultValue(){return{...super.getDefaultValue(),clipboardAutosync:!0}}formatServerArguments(){return Object.entries(this.value).map(([key,value])=>[key,toScrcpyOptionValue(value,void 0)]).filter(pair=>void 0!==pair[1]).map(([key,value])=>`${key.replace(/([A-Z])/g,"_$1").toLowerCase()}=${value}`)}}let ScrcpyInjectScrollControlMessage1_22=new struct_esm.ZP().fields(ScrcpyInjectScrollControlMessage1_16).int32("buttons");class ScrcpyOptions1_22 extends ScrcpyOptions1_21{constructor(init){init.rawVideoStream&&(init.sendDeviceMeta=!1,init.sendFrameMeta=!1,init.sendDummyByte=!1),super(init)}getDefaultValue(){return{...super.getDefaultValue(),downsizeOnError:!0,sendDeviceMeta:!0,sendDummyByte:!0,rawVideoStream:!1}}serializeInjectScrollControlMessage(message){return ScrcpyInjectScrollControlMessage1_22.serialize(message)}}let KEYFRAME_PTS=BigInt(1)<<BigInt(62);class ScrcpyOptions1_23 extends ScrcpyOptions1_22{constructor(init){super(init)}getDefaultValue(){return{...super.getDefaultValue(),cleanup:!0}}createVideoStreamTransformer(){let superStream=super.createVideoStreamTransformer();return{writable:superStream.writable,readable:superStream.readable.pipeThrough(new stream_extra_esm.GJ({transform(packet,controller){if("frame"!==packet.type){controller.enqueue(packet);return}void 0!==packet.pts&&packet.pts&KEYFRAME_PTS&&(packet.keyframe=!0,packet.pts&=~KEYFRAME_PTS),controller.enqueue(packet)}}))}}}class ScrcpyOptions1_24 extends ScrcpyOptions1_23{constructor(init){super(init)}getDefaultValue(){return{...super.getDefaultValue(),powerOn:!0}}}class ArrayToStream extends stream_extra_esm.Pz{array;index=0;constructor(array){super({start:async()=>{await Promise.resolve(),this.array=array},pull:controller=>{this.index<this.array.length?(controller.enqueue(this.array[this.index]),this.index+=1):controller.close()}})}}class ConcatStream extends stream_extra_esm.Pz{streams;index=0;reader;constructor(...streams){super({start:async controller=>{await Promise.resolve(),this.streams=streams,this.advance(controller)},pull:async controller=>{let result=await this.reader.read();if(!result.done){controller.enqueue(result.value);return}this.advance(controller)}})}advance(controller){this.index<this.streams.length?(this.reader=this.streams[this.index].getReader(),this.index+=1):controller.close()}}class AdbScrcpyClient{static pushServer(adb,path=DEFAULT_SERVER_PATH){let sync;return new stream_extra_esm.BF({start:async()=>(sync=await adb.sync()).write(path),async close(){await sync.dispose()}})}static async start(adb,path,version,options){let process;let connection=options.createConnection(adb);try{await connection.initialize(),process=await adb.subprocess.spawn([`CLASSPATH=${path}`,"app_process","/","com.genymobile.scrcpy.Server",version,...options.formatServerArguments()],{protocols:[esm.vf]});let stdout=process.stdout.pipeThrough(new stream_extra_esm.xU).pipeThrough(new stream_extra_esm.Jb("\n")),output=[],abortController=new stream_extra_esm.HS,pipe=stdout.pipeTo(new stream_extra_esm.Vj({write(chunk){output.push(chunk)}}),{signal:abortController.signal,preventCancel:!0}).catch(()=>{}),result=await Promise.race([process.exit,connection.getStreams()]);if("number"==typeof result){let error=Error("scrcpy server exited prematurely");throw error.output=output,error}abortController.abort(),await pipe;let[videoStream,controlStream]=result;return new AdbScrcpyClient(options,process,new ConcatStream(new ArrayToStream(output),stdout),videoStream,controlStream)}catch(e){throw await process?.kill(),e}finally{connection.dispose()}}static async getEncoders(adb,path,version,options){options.value.encoderName="_",options.value.control=!1,options.value.sendDeviceMeta=!1,options.value.sendDummyByte=!1;let client=await AdbScrcpyClient.start(adb,path,version,options),encoderNameRegex=options.getOutputEncoderNameRegex(),encoders=[];return await client.stdout.pipeTo(new stream_extra_esm.Vj({write(line){let match=line.match(encoderNameRegex);match&&encoders.push(match[1])}})),encoders}static async getDisplays(adb,path,version,options){options.value.displayId=-1,options.value.control=!1,options.value.sendDeviceMeta=!1,options.value.sendDummyByte=!1;try{await AdbScrcpyClient.start(adb,path,version,options)}catch(e){if(e instanceof Error){let output=e.output,displayIdRegex=/\s+scrcpy --display (\d+)/,displays=[];for(let line of output){let match=line.match(displayIdRegex);match&&displays.push(Number.parseInt(match[1],10))}return displays}}throw Error("failed to get displays")}process;_stdout;get stdout(){return this._stdout}get exit(){return this.process.exit}_screenWidth;get screenWidth(){return this._screenWidth}_screenHeight;get screenHeight(){return this._screenHeight}_videoStream;get videoStream(){return this._videoStream}_controlMessageSerializer;get controlMessageSerializer(){return this._controlMessageSerializer}_deviceMessageStream;get deviceMessageStream(){return this._deviceMessageStream}constructor(options,process,stdout,videoStream,controlStream){this.process=process,this._stdout=stdout,this._videoStream=videoStream.pipeThrough(options.createVideoStreamTransformer()).pipeThrough(new stream_extra_esm.N7(packet=>{"configuration"===packet.type&&(this._screenWidth=packet.data.croppedWidth,this._screenHeight=packet.data.croppedHeight)})),controlStream&&(this._controlMessageSerializer=new ScrcpyControlMessageSerializer(controlStream.writable,options),this._deviceMessageStream=controlStream.readable.pipeThrough(new ScrcpyDeviceMessageDeserializeStream))}async close(){await this.process.kill()}}(AndroidCodecProfile=AndroidCodecProfile1=AndroidCodecProfile1||(AndroidCodecProfile1={}))[AndroidCodecProfile.Baseline=1]="Baseline",AndroidCodecProfile[AndroidCodecProfile.Main=2]="Main",AndroidCodecProfile[AndroidCodecProfile.Extended=4]="Extended",AndroidCodecProfile[AndroidCodecProfile.High=8]="High",AndroidCodecProfile[AndroidCodecProfile.High10=16]="High10",AndroidCodecProfile[AndroidCodecProfile.High422=32]="High422",AndroidCodecProfile[AndroidCodecProfile.High444=64]="High444",AndroidCodecProfile[AndroidCodecProfile.ConstrainedBaseline=65536]="ConstrainedBaseline",AndroidCodecProfile[AndroidCodecProfile.ConstrainedHigh=524288]="ConstrainedHigh",(AndroidCodecLevel=AndroidCodecLevel1=AndroidCodecLevel1||(AndroidCodecLevel1={}))[AndroidCodecLevel.Level1=1]="Level1",AndroidCodecLevel[AndroidCodecLevel.Level1b=2]="Level1b",AndroidCodecLevel[AndroidCodecLevel.Level11=4]="Level11",AndroidCodecLevel[AndroidCodecLevel.Level12=8]="Level12",AndroidCodecLevel[AndroidCodecLevel.Level13=16]="Level13",AndroidCodecLevel[AndroidCodecLevel.Level2=32]="Level2",AndroidCodecLevel[AndroidCodecLevel.Level21=64]="Level21",AndroidCodecLevel[AndroidCodecLevel.Level22=128]="Level22",AndroidCodecLevel[AndroidCodecLevel.Level3=256]="Level3",AndroidCodecLevel[AndroidCodecLevel.Level31=512]="Level31",AndroidCodecLevel[AndroidCodecLevel.Level32=1024]="Level32",AndroidCodecLevel[AndroidCodecLevel.Level4=2048]="Level4",AndroidCodecLevel[AndroidCodecLevel.Level41=4096]="Level41",AndroidCodecLevel[AndroidCodecLevel.Level42=8192]="Level42",AndroidCodecLevel[AndroidCodecLevel.Level5=16384]="Level5",AndroidCodecLevel[AndroidCodecLevel.Level51=32768]="Level51",AndroidCodecLevel[AndroidCodecLevel.Level52=65536]="Level52",AndroidCodecLevel[AndroidCodecLevel.Level6=131072]="Level6",AndroidCodecLevel[AndroidCodecLevel.Level61=262144]="Level61",AndroidCodecLevel[AndroidCodecLevel.Level62=524288]="Level62";let workerReady=!1,pendingResolvers=[],streamId=0,PICTURE_READY_SUBSCRIPTIONS=new Map;class TinyH264Wrapper extends event_esm.Xn{streamId;pictureReadyEvent=new event_esm.vp;get onPictureReady(){return this.pictureReadyEvent.event}constructor(streamId){var handler;super(),this.streamId=streamId,this.addDisposable((handler=this.handlePictureReady,PICTURE_READY_SUBSCRIPTIONS.set(streamId,handler),{dispose(){PICTURE_READY_SUBSCRIPTIONS.delete(streamId)}}))}handlePictureReady=e=>{this.pictureReadyEvent.fire(e)};feed(data){worker.postMessage({type:"decode",data:data,offset:0,length:data.byteLength,renderStateId:this.streamId},[data])}dispose(){super.dispose(),worker.postMessage({type:"release",renderStateId:this.streamId})}}function initialize(){return cachedInitializePromise||(cachedInitializePromise=Promise.all([__webpack_require__.e(118).then(__webpack_require__.t.bind(__webpack_require__,6118,19)),__webpack_require__.e(337).then(__webpack_require__.t.bind(__webpack_require__,6337,19))]).then(([YuvBuffer,{default:YuvCanvas}])=>({YuvBuffer,YuvCanvas}))),cachedInitializePromise}class TinyH264Decoder{maxProfile=AndroidCodecProfile1.Baseline;maxLevel=AndroidCodecLevel1.Level4;_renderer;get renderer(){return this._renderer}_frameRendered=0;get frameRendered(){return this._frameRendered}_writable;get writable(){return this._writable}_yuvCanvas;_initializer;constructor(){initialize(),this._renderer=document.createElement("canvas"),this._writable=new stream_extra_esm.Vj({write:async packet=>{switch(packet.type){case"configuration":this.configure(packet.data);break;case"frame":if(!this._initializer)throw Error("Decoder not initialized");let wrapper=await this._initializer.promise;wrapper.feed(packet.data.slice().buffer)}}})}async configure(config){this.dispose(),this._initializer=new async_esm.hP;let{YuvBuffer,YuvCanvas}=await initialize();this._yuvCanvas||(this._yuvCanvas=YuvCanvas.attach(this._renderer));let{encodedWidth,encodedHeight}=config,chromaWidth=encodedWidth/2,chromaHeight=encodedHeight/2;this._renderer.width=config.croppedWidth,this._renderer.height=config.croppedHeight;let format=YuvBuffer.format({width:encodedWidth,height:encodedHeight,chromaWidth,chromaHeight,cropLeft:config.cropLeft,cropTop:config.cropTop,cropWidth:config.croppedWidth,cropHeight:config.croppedHeight,displayWidth:config.croppedWidth,displayHeight:config.croppedHeight}),wrapper=await function(){if(worker||(worker=new Worker(__webpack_require__.tu(new URL(__webpack_require__.p+__webpack_require__.u(292),__webpack_require__.b)))).addEventListener("message",e=>{let{data}=e;switch(data.type){case"decoderReady":for(let resolver of(workerReady=!0,pendingResolvers))resolver.resolve(new TinyH264Wrapper(streamId)),streamId+=1;pendingResolvers.length=0;break;case"pictureReady":PICTURE_READY_SUBSCRIPTIONS.get(data.renderStateId)?.(data)}}),!workerReady){let resolver=new async_esm.hP;return pendingResolvers.push(resolver),resolver.promise}let decoder=new TinyH264Wrapper(streamId);return streamId+=1,Promise.resolve(decoder)}();this._initializer.resolve(wrapper);let uPlaneOffset=encodedWidth*encodedHeight,vPlaneOffset=uPlaneOffset+chromaWidth*chromaHeight;wrapper.onPictureReady(({data})=>{this._frameRendered+=1;let array=new Uint8Array(data),frame=YuvBuffer.frame(format,YuvBuffer.lumaPlane(format,array,encodedWidth,0),YuvBuffer.chromaPlane(format,array,chromaWidth,uPlaneOffset),YuvBuffer.chromaPlane(format,array,chromaWidth,vPlaneOffset));this._yuvCanvas.drawFrame(frame)})}dispose(){this._initializer?.promise.then(wrapper=>wrapper.dispose()),this._initializer=void 0}}function toHex(value){return value.toString(16).padStart(2,"0").toUpperCase()}class WebCodecsDecoder{maxProfile=void 0;maxLevel=void 0;_writable;get writable(){return this._writable}_renderer;get renderer(){return this._renderer}_frameRendered=0;get frameRendered(){return this._frameRendered}context;decoder;lastFrame;animationFrame=0;constructor(){this._renderer=document.createElement("canvas"),this.context=this._renderer.getContext("2d"),this.decoder=new VideoDecoder({output:frame=>{this.lastFrame&&this.lastFrame.close(),this.lastFrame=frame,this.animationFrame||this.render()},error(){}}),this._writable=new stream_extra_esm.Vj({write:async packet=>{switch(packet.type){case"configuration":this.configure(packet.data);break;case"frame":this.decoder.decode(new EncodedVideoChunk({type:!1===packet.keyframe?"delta":"key",timestamp:0,data:packet.data}))}}})}render=()=>{this.lastFrame&&(this._frameRendered+=1,this.context.drawImage(this.lastFrame,0,0),this.lastFrame.close(),this.lastFrame=void 0),this.animationFrame=requestAnimationFrame(this.render)};configure(config){let{profileIndex,constraintSet,levelIndex}=config;this._renderer.width=config.croppedWidth,this._renderer.height=config.croppedHeight;let codec=`avc1.${[profileIndex,constraintSet,levelIndex].map(toHex).join("")}`;this.decoder.configure({codec:codec,optimizeForLatency:!0})}dispose(){cancelAnimationFrame(this.animationFrame),this.decoder.close()}}var version="1.24",components=__webpack_require__(4347),state=__webpack_require__(2344),utils=__webpack_require__(5155);let SERVER_URL=new __webpack_require__.U(__webpack_require__(4439));class FetchWithProgress{get downloaded(){return this._downloaded}get total(){return this._total}get onProgress(){return this.progressEvent.event}async fetch(url){var ref;let response=await window.fetch(url);this._total=Number.parseInt(null!==(ref=response.headers.get("Content-Length"))&&void 0!==ref?ref:"0",10),this.progressEvent.fire([this._downloaded,this._total]);let reader=response.body.getReader(),chunks=[];for(;;){let result=await reader.read();if(result.done)break;chunks.push(result.value),this._downloaded+=result.value.byteLength,this.progressEvent.fire([this._downloaded,this._total])}this._total=chunks.reduce((result,item)=>result+item.byteLength,0);let result1=new Uint8Array(this._total),position=0;for(let chunk of chunks)result1.set(chunk,position),position+=chunk.byteLength;return result1}constructor(url){this._downloaded=0,this._total=0,this.progressEvent=new event_esm.vp,this.promise=this.fetch(url)}}function fetchServer(onProgress){return cachedValue||(cachedValue=new FetchWithProgress(SERVER_URL)).promise.catch(e=>{cachedValue=void 0}),onProgress&&(cachedValue.onProgress(onProgress),onProgress([cachedValue.downloaded,cachedValue.total])),cachedValue.promise}let useClasses=(0,makeStyles_esm.Z)({labelRight:{marginLeft:"4px"},video:{transformOrigin:"center center"}}),SettingItem=(0,es.Pi)(function(param){let{definition,settings,onChange}=param,classes=useClasses(),label=(0,jsx_runtime.jsxs)(Stack.K,{horizontal:!0,verticalAlign:"center",children:[(0,jsx_runtime.jsx)("span",{children:definition.label}),!!definition.description&&(0,jsx_runtime.jsx)(TooltipHost.G,{content:definition.description,children:(0,jsx_runtime.jsx)(Icon.J,{className:classes.labelRight,iconName:utils.PJ.Info})}),definition.labelExtra]});switch(definition.type){case"text":return(0,jsx_runtime.jsx)(TextField.n,{label:label,placeholder:definition.placeholder,value:settings[definition.key],onChange:(e,value)=>onChange(definition.key,value)});case"dropdown":return(0,jsx_runtime.jsx)(Dropdown.L,{label:label,options:definition.options,placeholder:definition.placeholder,selectedKey:settings[definition.key],onChange:(e,option)=>onChange(definition.key,option.key)});case"toggle":return(0,jsx_runtime.jsx)(Toggle.Z,{label:label,checked:settings[definition.key],onChange:(e,checked)=>onChange(definition.key,checked)});case"number":return(0,jsx_runtime.jsx)(SpinButton.k,{label:definition.label,labelPosition:positioning_types.L.top,min:definition.min,max:definition.max,step:definition.step,value:settings[definition.key].toString(),onChange:(e,value)=>onChange(definition.key,Number.parseInt(value,10))})}}),scrcpy_state=new class{get rotatedWidth(){return 1&scrcpy_state.rotate?scrcpy_state.height:scrcpy_state.width}get rotatedHeight(){return 1&scrcpy_state.rotate?scrcpy_state.width:scrcpy_state.height}async pushServer(){let serverBuffer=await fetchServer();await new stream_extra_esm.Pz({start(controller){controller.enqueue(serverBuffer),controller.close()}}).pipeTo(AdbScrcpyClient.pushServer(state.q.device))}get commandBarItems(){let result=[];return this.running?result.push({key:"stop",iconProps:{iconName:utils.PJ.Stop},text:"Stop",onClick:this.stop}):result.push({key:"start",disabled:!state.q.device,iconProps:{iconName:utils.PJ.Play},text:"Start",onClick:this.start}),result.push({key:"fullscreen",disabled:!this.running,iconProps:{iconName:utils.PJ.FullScreenMaximize},iconOnly:!0,text:"Fullscreen",onClick:()=>{var ref;null===(ref=this.deviceView)||void 0===ref||ref.enterFullscreen()}}),result.push({key:"volumeUp",disabled:!this.running,iconProps:{iconName:utils.PJ.Speaker2},iconOnly:!0,text:"Volume Up",onClick:async()=>{var ref,ref1;await (null===(ref=this.client)||void 0===ref?void 0:ref.controlMessageSerializer.injectKeyCode({action:AndroidKeyEventAction1.Down,keyCode:AndroidKeyCode1.VolumeUp,repeat:0,metaState:0})),await (null===(ref1=this.client)||void 0===ref1?void 0:ref1.controlMessageSerializer.injectKeyCode({action:AndroidKeyEventAction1.Up,keyCode:AndroidKeyCode1.VolumeUp,repeat:0,metaState:0}))}},{key:"volumeDown",disabled:!this.running,iconProps:{iconName:utils.PJ.Speaker1},iconOnly:!0,text:"Volume Down",onClick:async()=>{var ref,ref1;await (null===(ref=this.client)||void 0===ref?void 0:ref.controlMessageSerializer.injectKeyCode({action:AndroidKeyEventAction1.Down,keyCode:AndroidKeyCode1.VolumeDown,repeat:0,metaState:0})),await (null===(ref1=this.client)||void 0===ref1?void 0:ref1.controlMessageSerializer.injectKeyCode({action:AndroidKeyEventAction1.Up,keyCode:AndroidKeyCode1.VolumeDown,repeat:0,metaState:0}))}},{key:"volumeMute",disabled:!this.running,iconProps:{iconName:utils.PJ.SpeakerOff},iconOnly:!0,text:"Toggle Mute",onClick:async()=>{var ref,ref1;await (null===(ref=this.client)||void 0===ref?void 0:ref.controlMessageSerializer.injectKeyCode({action:AndroidKeyEventAction1.Down,keyCode:AndroidKeyCode1.VolumeMute,repeat:0,metaState:0})),await (null===(ref1=this.client)||void 0===ref1?void 0:ref1.controlMessageSerializer.injectKeyCode({action:AndroidKeyEventAction1.Up,keyCode:AndroidKeyCode1.VolumeMute,repeat:0,metaState:0}))}}),result.push({key:"rotateDevice",disabled:!this.running,iconProps:{iconName:utils.PJ.Orientation},iconOnly:!0,text:"Rotate Device",onClick:()=>{this.client.controlMessageSerializer.rotateDevice()}},{key:"rotateVideoLeft",disabled:!this.running,iconProps:{iconName:utils.PJ.RotateLeft},iconOnly:!0,text:"Rotate Video Left",onClick:(0,mobx_esm.aD)(()=>{this.rotate-=1,this.rotate<0&&(this.rotate=3)})},{key:"rotateVideoRight",disabled:!this.running,iconProps:{iconName:utils.PJ.RotateRight},iconOnly:!0,text:"Rotate Video Right",onClick:(0,mobx_esm.aD)(()=>{this.rotate=this.rotate+1&3})}),result.push({key:"turnScreenOff",disabled:!this.running,iconProps:{iconName:utils.PJ.Lightbulb},iconOnly:!0,text:"Turn Screen Off",onClick:()=>{this.client.controlMessageSerializer.setScreenPowerMode(AndroidScreenPowerMode1.Off)}},{key:"turnScreenOn",disabled:!this.running,iconProps:{iconName:utils.PJ.LightbulbFilament},iconOnly:!0,text:"Turn Screen On",onClick:()=>{this.client.controlMessageSerializer.setScreenPowerMode(AndroidScreenPowerMode1.Normal)}}),this.running&&result.push({key:"fps",text:"FPS: ".concat(this.fps),disabled:!0}),result}get commandBarFarItems(){return[{key:"NavigationBar",iconProps:{iconName:utils.PJ.PanelBottom},checked:this.navigationBarVisible,text:"Navigation Bar",iconOnly:!0,onClick:(0,mobx_esm.aD)(()=>{this.navigationBarVisible=!this.navigationBarVisible})},{key:"Log",iconProps:{iconName:utils.PJ.TextGrammarError},checked:this.logVisible,text:"Log",iconOnly:!0,onClick:(0,mobx_esm.aD)(()=>{this.logVisible=!this.logVisible})},{key:"Settings",iconProps:{iconName:utils.PJ.Settings},checked:this.settingsVisible,text:"Settings",iconOnly:!0,onClick:(0,mobx_esm.aD)(()=>{this.settingsVisible=!this.settingsVisible})},{key:"DemoMode",iconProps:{iconName:utils.PJ.Wand},checked:this.demoModeVisible,text:"Demo Mode",iconOnly:!0,onClick:(0,mobx_esm.aD)(()=>{this.demoModeVisible=!this.demoModeVisible})},{key:"info",iconProps:{iconName:utils.PJ.Info},iconOnly:!0,tooltipHostProps:{content:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("p",{children:[(0,jsx_runtime.jsx)(components.dL,{href:"https://github.com/Genymobile/scrcpy",spaceAfter:!0,children:"Scrcpy"}),"developed by Genymobile can display the screen with low latency (1~2 frames) and control the device, all without root access."]}),(0,jsx_runtime.jsx)("p",{children:"This is a TypeScript implementation of the client part. Paired with official pre-built server binary."})]}),calloutProps:{calloutMaxWidth:300}}}]}get settingDefinitions(){let result=[];return result.push({key:"powerOn",type:"toggle",label:"Turn device on when starting"},{key:"turnScreenOff",type:"toggle",label:"Turn screen off when starting"},{key:"stayAwake",type:"toggle",label:"Stay awake (if plugged in)"},{key:"powerOffOnClose",type:"toggle",label:"Turn device off when exiting"}),result.push({key:"displayId",type:"dropdown",label:"Display",placeholder:"Press refresh to update available displays",labelExtra:(0,jsx_runtime.jsx)(IconButton.h,{iconProps:{iconName:utils.PJ.ArrowClockwise},disabled:!state.q.device,text:"Refresh",onClick:this.updateDisplays}),options:this.displays.map(item=>({key:item,text:item.toString()}))}),result.push({key:"crop",type:"text",label:"Crop",placeholder:"W:H:X:Y"}),result.push({key:"maxSize",type:"number",label:"Max Resolution (longer side, 0 = unlimited)",min:0,max:2560,step:50}),result.push({key:"bitRate",type:"number",label:"Max Bit Rate",min:100,max:1e8,step:100}),result.push({key:"lockVideoOrientation",type:"dropdown",label:"Lock Video Orientation",options:[{key:ScrcpyVideoOrientation1.Unlocked,text:"Unlocked"},{key:ScrcpyVideoOrientation1.Initial,text:"Current"},{key:ScrcpyVideoOrientation1.Portrait,text:"Portrait"},{key:ScrcpyVideoOrientation1.Landscape,text:"Landscape"},{key:ScrcpyVideoOrientation1.PortraitFlipped,text:"Portrait (Flipped)"},{key:ScrcpyVideoOrientation1.LandscapeFlipped,text:"Landscape (Flipped)"}]}),result.push({key:"encoderName",type:"dropdown",label:"Encoder",placeholder:"Press refresh to update available encoders",labelExtra:(0,jsx_runtime.jsx)(IconButton.h,{iconProps:{iconName:utils.PJ.ArrowClockwise},disabled:!state.q.device,text:"Refresh",onClick:this.updateEncoders}),options:this.encoders.map(item=>({key:item,text:item}))}),this.decoders.length>1&&result.push({key:"decoder",type:"dropdown",label:"Decoder",options:this.decoders.map(item=>({key:item.key,text:item.name,data:item}))}),result.push({key:"ignoreDecoderCodecArgs",type:"toggle",label:"Ignore decoder's codec arguments",description:"Some decoders don't support all H.264 profile/levels, so they request the device to encode at their highest-supported codec. However, some super old devices may not support that codec so their encoders will fail to start. Use this option to let device choose the codec to be used."}),result.push({key:"tunnelForward",type:"toggle",label:"Use forward connection",description:"Android before version 9 has a bug that prevents reverse tunneling when using ADB over WiFi."}),result}async stop(){var ref;await (null===(ref=this.client)||void 0===ref?void 0:ref.close()),this.dispose()}dispose(){var ref;null===(ref=this.decoder)||void 0===ref||ref.dispose(),this.decoder=void 0,this.fps=0,clearTimeout(this.fpsCounterIntervalId),this.client=void 0,this.running=!1}handleDeviceViewRef(element){this.deviceView=element}handleRendererContainerRef(element){var ref;this.rendererContainer=element,null===(ref=this.rendererContainer)||void 0===ref||ref.addEventListener("wheel",this.handleWheel,{passive:!1})}calculatePointerPosition(clientX,clientY){var value,value1;let viewRect=this.rendererContainer.getBoundingClientRect(),pointerViewX=(value=(clientX-viewRect.x)/viewRect.width)<0?0:value>1?1:value,pointerViewY=(value1=(clientY-viewRect.y)/viewRect.height)<0?0:value1>1?1:value1;switch(1&this.rotate&&([pointerViewX,pointerViewY]=[pointerViewY,pointerViewX]),this.rotate){case 1:pointerViewY=1-pointerViewY;break;case 2:pointerViewX=1-pointerViewX,pointerViewY=1-pointerViewY;break;case 3:pointerViewX=1-pointerViewX}return{x:pointerViewX*this.width,y:pointerViewY*this.height}}constructor(){this.running=!1,this.deviceView=null,this.rendererContainer=null,this.logVisible=!1,this.log=[],this.settingsVisible=!1,this.demoModeVisible=!1,this.navigationBarVisible=!0,this.width=0,this.height=0,this.rotate=0,this.client=void 0,this.encoders=[],this.updateEncoders=async()=>{try{await this.pushServer();let encoders=await AdbScrcpyClient.getEncoders(state.q.device,DEFAULT_SERVER_PATH,version,new AdbScrcpyOptions1_22(new ScrcpyOptions1_24({logLevel:ScrcpyLogLevel1.Debug,tunnelForward:this.settings.tunnelForward})));(0,mobx_esm.z)(()=>{this.encoders=encoders,this.settings.encoderName&&this.encoders.includes(this.settings.encoderName)||(this.settings.encoderName=this.encoders[0])})}catch(e){state.q.showErrorDialog(e)}},this.decoders=[{key:"tinyh264",name:"TinyH264 (Software)",Constructor:TinyH264Decoder}],this.decoder=void 0,this.fpsCounterIntervalId=void 0,this.fps=0,this.displays=[],this.updateDisplays=async()=>{try{await this.pushServer();let displays=await AdbScrcpyClient.getDisplays(state.q.device,DEFAULT_SERVER_PATH,version,new AdbScrcpyOptions1_22(new ScrcpyOptions1_24({logLevel:ScrcpyLogLevel1.Debug,tunnelForward:this.settings.tunnelForward})));(0,mobx_esm.z)(()=>{this.displays=displays,this.settings.displayId&&this.displays.includes(this.settings.displayId)||(this.settings.displayId=this.displays[0])})}catch(e){state.q.showErrorDialog(e)}},this.connecting=!1,this.serverTotalSize=0,this.serverDownloadedSize=0,this.debouncedServerDownloadedSize=0,this.serverDownloadSpeed=0,this.serverUploadedSize=0,this.debouncedServerUploadedSize=0,this.serverUploadSpeed=0,this.settings={maxSize:1080,bitRate:4e6,lockVideoOrientation:ScrcpyVideoOrientation1.Unlocked,displayId:0,crop:"",powerOn:!0},this.start=async()=>{if(state.q.device)try{var ref;let serverBuffer;if(!this.settings.decoder)throw Error("No available decoder");(0,mobx_esm.z)(()=>{this.serverTotalSize=0,this.serverDownloadedSize=0,this.debouncedServerDownloadedSize=0,this.serverUploadedSize=0,this.debouncedServerUploadedSize=0,this.connecting=!0});let intervalId=setInterval((0,mobx_esm.aD)(()=>{this.serverDownloadSpeed=this.serverDownloadedSize-this.debouncedServerDownloadedSize,this.debouncedServerDownloadedSize=this.serverDownloadedSize}),1e3);try{serverBuffer=await fetchServer((0,mobx_esm.aD)(param=>{let[downloaded,total]=param;this.serverDownloadedSize=downloaded,this.serverTotalSize=total})),(0,mobx_esm.z)(()=>{this.serverDownloadSpeed=this.serverDownloadedSize-this.debouncedServerDownloadedSize,this.debouncedServerDownloadedSize=this.serverDownloadedSize})}finally{clearInterval(intervalId)}intervalId=setInterval((0,mobx_esm.aD)(()=>{this.serverUploadSpeed=this.serverUploadedSize-this.debouncedServerUploadedSize,this.debouncedServerUploadedSize=this.serverUploadedSize}),1e3);try{await new stream_extra_esm.Pz({start(controller){controller.enqueue(serverBuffer),controller.close()}}).pipeThrough(new stream_extra_esm.Cc(esm.j4)).pipeThrough(new utils.hK((0,mobx_esm.aD)(progress=>{this.serverUploadedSize=progress}))).pipeTo(AdbScrcpyClient.pushServer(state.q.device)),(0,mobx_esm.z)(()=>{this.serverUploadSpeed=this.serverUploadedSize-this.debouncedServerUploadedSize,this.debouncedServerUploadedSize=this.serverUploadedSize})}finally{clearInterval(intervalId)}let decoderDefinition=null!==(ref=this.decoders.find(x=>x.key===this.settings.decoder))&&void 0!==ref?ref:this.decoders[0],decoder=new decoderDefinition.Constructor;(0,mobx_esm.z)(()=>{this.decoder=decoder;let lastFrameCount=0;this.fpsCounterIntervalId=setInterval((0,mobx_esm.aD)(()=>{this.fps=decoder.frameRendered-lastFrameCount,lastFrameCount=decoder.frameRendered}),1e3)});let options=new AdbScrcpyOptions1_22(new ScrcpyOptions1_24({logLevel:ScrcpyLogLevel1.Debug,...this.settings,sendDeviceMeta:!1,sendDummyByte:!1,codecOptions:this.settings.ignoreDecoderCodecArgs?void 0:new CodecOptions({profile:decoder.maxProfile,level:decoder.maxLevel})}));(0,mobx_esm.z)(()=>{this.log=[],this.log.push("[client] Server version: ".concat(version)),this.log.push("[client] Server arguments: ".concat(options.formatServerArguments().join(" ")))});let client=await AdbScrcpyClient.start(state.q.device,DEFAULT_SERVER_PATH,version,options);client.stdout.pipeTo(new stream_extra_esm.Vj({write:(0,mobx_esm.aD)(line=>{this.log.push(line)})})),client.videoStream.pipeThrough(new stream_extra_esm.N7((0,mobx_esm.aD)(packet=>{if("configuration"===packet.type){let{croppedWidth,croppedHeight}=packet.data;this.log.push("[client] Video size changed: ".concat(croppedWidth,"x").concat(croppedHeight)),this.width=croppedWidth,this.height=croppedHeight}}))).pipeTo(decoder.writable).catch(()=>{}),client.exit.then(this.dispose),client.deviceMessageStream.pipeTo(new stream_extra_esm.Vj({write(message){message.type===ScrcpyDeviceMessageType1.Clipboard&&window.navigator.clipboard.writeText(message.content)}})).catch(()=>{}),this.settings.turnScreenOff&&await client.controlMessageSerializer.setScreenPowerMode(AndroidScreenPowerMode1.Off),(0,mobx_esm.z)(()=>{this.client=client,this.running=!0})}catch(e){state.q.showErrorDialog(e)}finally{(0,mobx_esm.z)(()=>{this.connecting=!1})}},this.handleBackPointerDown=e=>{this.client&&0===e.button&&(e.currentTarget.setPointerCapture(e.pointerId),this.client.controlMessageSerializer.backOrScreenOn(AndroidKeyEventAction1.Down))},this.handleBackPointerUp=e=>{this.client&&0===e.button&&this.client.controlMessageSerializer.backOrScreenOn(AndroidKeyEventAction1.Up)},this.handleHomePointerDown=e=>{this.client&&0===e.button&&(e.currentTarget.setPointerCapture(e.pointerId),this.client.controlMessageSerializer.injectKeyCode({action:AndroidKeyEventAction1.Down,keyCode:AndroidKeyCode1.Home,repeat:0,metaState:0}))},this.handleHomePointerUp=e=>{this.client&&0===e.button&&this.client.controlMessageSerializer.injectKeyCode({action:AndroidKeyEventAction1.Up,keyCode:AndroidKeyCode1.Home,repeat:0,metaState:0})},this.handleAppSwitchPointerDown=async e=>{this.client&&0===e.button&&(e.currentTarget.setPointerCapture(e.pointerId),this.client.controlMessageSerializer.injectKeyCode({action:AndroidKeyEventAction1.Down,keyCode:AndroidKeyCode1.AppSwitch,repeat:0,metaState:0}))},this.handleAppSwitchPointerUp=async e=>{this.client&&0===e.button&&this.client.controlMessageSerializer.injectKeyCode({action:AndroidKeyEventAction1.Up,keyCode:AndroidKeyCode1.AppSwitch,repeat:0,metaState:0})},this.injectTouch=(action,e)=>{if(!this.client)return;let{x,y}=this.calculatePointerPosition(e.clientX,e.clientY);this.client.controlMessageSerializer.injectTouch({action,pointerId:"mouse"===e.pointerType?BigInt(-1):BigInt(e.pointerId),screenWidth:this.client.screenWidth,screenHeight:this.client.screenHeight,pointerX:x,pointerY:y,pressure:65535*e.pressure,buttons:e.buttons})},this.handlePointerDown=e=>{this.rendererContainer.focus(),e.preventDefault(),e.currentTarget.setPointerCapture(e.pointerId),this.injectTouch(AndroidMotionEventAction1.Down,e)},this.handlePointerMove=e=>{this.injectTouch(0===e.buttons?AndroidMotionEventAction1.HoverMove:AndroidMotionEventAction1.Move,e)},this.handlePointerUp=e=>{this.injectTouch(AndroidMotionEventAction1.Up,e)},this.handleWheel=e=>{if(!this.client)return;e.preventDefault(),e.stopPropagation();let{x,y}=this.calculatePointerPosition(e.clientX,e.clientY);this.client.controlMessageSerializer.injectScroll({screenWidth:this.client.screenWidth,screenHeight:this.client.screenHeight,pointerX:x,pointerY:y,scrollX:-Math.sign(e.deltaX),scrollY:-Math.sign(e.deltaY),buttons:0})},this.handleContextMenu=e=>{e.preventDefault()},this.handleKeyDown=async e=>{if(!this.client)return;let{key,code}=e;if(key.match(/^[!-`{-~]$/i)){this.client.controlMessageSerializer.injectText(key);return}let keyCode={Backspace:AndroidKeyCode1.Delete,Space:AndroidKeyCode1.Space,Enter:AndroidKeyCode1.Enter}[code];keyCode&&(this.client.controlMessageSerializer.injectKeyCode({action:AndroidKeyEventAction1.Down,keyCode,metaState:0,repeat:0}),this.client.controlMessageSerializer.injectKeyCode({action:AndroidKeyEventAction1.Up,keyCode,metaState:0,repeat:0}))},(0,mobx_esm.ky)(this,{decoders:mobx_esm.LO.shallow,settings:mobx_esm.LO.deep,start:!1,stop:mobx_esm.aD.bound,dispose:mobx_esm.aD.bound,handleDeviceViewRef:mobx_esm.aD.bound,handleRendererContainerRef:mobx_esm.aD.bound,handleBackPointerDown:!1,handleBackPointerUp:!1,handleHomePointerDown:!1,handleHomePointerUp:!1,handleAppSwitchPointerDown:!1,handleAppSwitchPointerUp:!1,calculatePointerPosition:!1,injectTouch:!1,handlePointerDown:!1,handlePointerMove:!1,handlePointerUp:!1,handleWheel:!1,handleContextMenu:!1,handleKeyDown:!1}),(0,mobx_esm.EH)(()=>{state.q.device?(0,mobx_esm.z)(()=>{this.encoders=[],this.settings.encoderName=void 0,this.displays=[],this.settings.displayId=void 0}):this.dispose()}),(0,mobx_esm.EH)(()=>{if(this.rendererContainer&&this.decoder){for(;this.rendererContainer.firstChild;)this.rendererContainer.firstChild.remove();this.rendererContainer.appendChild(this.decoder.renderer)}}),(0,mobx_esm.EH)(()=>{this.settings.decoder=this.decoders[0].key}),"function"==typeof window.VideoDecoder&&setTimeout((0,mobx_esm.aD)(()=>{this.decoders.unshift({key:"webcodecs",name:"WebCodecs",Constructor:WebCodecsDecoder})}),0)}},ConnectionDialog=(0,es.Pi)(()=>{let layerHostId=(0,useId.M)("layerHost"),[isClient,setIsClient]=(0,react.useState)(!1);return((0,react.useEffect)(()=>{setIsClient(!0)},[]),isClient)?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LayerHost,{id:layerHostId,style:{position:"absolute",top:0,bottom:0,left:0,right:0,margin:0,pointerEvents:"none"}}),(0,jsx_runtime.jsx)(Dialog.V,{hidden:!scrcpy_state.connecting,modalProps:{layerProps:{hostId:layerHostId}},dialogContentProps:{title:"Connecting..."},children:(0,jsx_runtime.jsxs)(Stack.K,{tokens:utils.WT,children:[(0,jsx_runtime.jsx)(ProgressIndicator.Y,{label:"1. Downloading scrcpy server...",percentComplete:scrcpy_state.serverTotalSize?scrcpy_state.serverDownloadedSize/scrcpy_state.serverTotalSize:void 0,description:(0,utils.CY)(scrcpy_state.debouncedServerDownloadedSize,scrcpy_state.serverTotalSize,scrcpy_state.serverDownloadSpeed)}),(0,jsx_runtime.jsx)(ProgressIndicator.Y,{label:"2. Pushing scrcpy server to device...",progressHidden:0===scrcpy_state.serverTotalSize||scrcpy_state.serverDownloadedSize!==scrcpy_state.serverTotalSize,percentComplete:scrcpy_state.serverUploadedSize/scrcpy_state.serverTotalSize,description:(0,utils.CY)(scrcpy_state.debouncedServerUploadedSize,scrcpy_state.serverTotalSize,scrcpy_state.serverUploadSpeed)}),(0,jsx_runtime.jsx)(ProgressIndicator.Y,{label:"3. Starting scrcpy server on device...",progressHidden:0===scrcpy_state.serverTotalSize||scrcpy_state.serverUploadedSize!==scrcpy_state.serverTotalSize})]})})]}):null}),NavigationBar=(0,es.Pi)(function(param){let{className,style,children}=param;return scrcpy_state.navigationBarVisible?(0,jsx_runtime.jsxs)(Stack.K,{className:className,verticalFill:!0,horizontalAlign:"center",style:{height:"40px",background:"#999",...style},children:[children,(0,jsx_runtime.jsxs)(Stack.K,{verticalFill:!0,horizontal:!0,style:{width:"100%",maxWidth:300},horizontalAlign:"space-evenly",verticalAlign:"center",children:[(0,jsx_runtime.jsx)(IconButton.h,{iconProps:{iconName:utils.PJ.Play},style:{transform:"rotate(180deg)",color:"white"},onPointerDown:scrcpy_state.handleBackPointerDown,onPointerUp:scrcpy_state.handleBackPointerUp}),(0,jsx_runtime.jsx)(IconButton.h,{iconProps:{iconName:utils.PJ.Circle},style:{color:"white"},onPointerDown:scrcpy_state.handleHomePointerDown,onPointerUp:scrcpy_state.handleHomePointerUp}),(0,jsx_runtime.jsx)(IconButton.h,{iconProps:{iconName:utils.PJ.Stop},style:{color:"white"},onPointerDown:scrcpy_state.handleAppSwitchPointerDown,onPointerUp:scrcpy_state.handleAppSwitchPointerUp})]})]}):(0,jsx_runtime.jsx)("div",{className:className,style:style,children:children})}),Scrcpy=()=>{let classes=useClasses();return(0,jsx_runtime.jsxs)(Stack.K,{...utils.LE,children:[(0,jsx_runtime.jsx)(head_default(),{children:(0,jsx_runtime.jsx)("title",{children:"Scrcpy - Android Web Toolbox"})}),(0,jsx_runtime.jsx)(CommandBar.X,{items:scrcpy_state.commandBarItems,farItems:scrcpy_state.commandBarFarItems}),(0,jsx_runtime.jsxs)(Stack.K,{horizontal:!0,grow:!0,styles:{root:{height:0}},children:[(0,jsx_runtime.jsx)(components.wM,{ref:scrcpy_state.handleDeviceViewRef,width:scrcpy_state.rotatedWidth,height:scrcpy_state.rotatedHeight,BottomElement:NavigationBar,children:(0,jsx_runtime.jsx)("div",{ref:scrcpy_state.handleRendererContainerRef,tabIndex:-1,className:classes.video,style:{width:scrcpy_state.width,height:scrcpy_state.height,transform:"translate(".concat((scrcpy_state.rotatedWidth-scrcpy_state.width)/2,"px, ").concat((scrcpy_state.rotatedHeight-scrcpy_state.height)/2,"px) rotate(").concat(90*scrcpy_state.rotate,"deg)")},onPointerDown:scrcpy_state.handlePointerDown,onPointerMove:scrcpy_state.handlePointerMove,onPointerUp:scrcpy_state.handlePointerUp,onPointerCancel:scrcpy_state.handlePointerUp,onKeyDown:scrcpy_state.handleKeyDown,onContextMenu:scrcpy_state.handleContextMenu})}),(0,jsx_runtime.jsx)("div",{style:{padding:12,overflow:"hidden auto",display:scrcpy_state.logVisible?"block":"none",width:500,fontFamily:"monospace",overflowY:"auto",whiteSpace:"pre-wrap",wordWrap:"break-word"},children:scrcpy_state.log.map((line,index)=>(0,jsx_runtime.jsx)("div",{children:line},index))}),(0,jsx_runtime.jsxs)("div",{style:{padding:12,overflow:"hidden auto",display:scrcpy_state.settingsVisible?"block":"none",width:300},children:[(0,jsx_runtime.jsx)("div",{children:"Changes will take effect on next connection"}),scrcpy_state.settingDefinitions.map(definition=>(0,jsx_runtime.jsx)(SettingItem,{definition:definition,settings:scrcpy_state.settings,onChange:(0,mobx_esm.aD)((key,value)=>scrcpy_state.settings[key]=value)},definition.key))]}),(0,jsx_runtime.jsx)(components.bq,{style:{display:scrcpy_state.demoModeVisible?"block":"none"}}),(0,jsx_runtime.jsx)(ConnectionDialog,{})]})]})};var scrcpy=(0,es.Pi)(Scrcpy)},4439:function(module,__unused_webpack_exports,__webpack_require__){"use strict";module.exports=__webpack_require__.p+"static/chunks/scrcpy-server.d406f4d14066a1d3"}},function(__webpack_require__){__webpack_require__.O(0,[81,774,888,179],function(){return __webpack_require__(__webpack_require__.s=7452)}),_N_E=__webpack_require__.O()}]);
//# sourceMappingURL=scrcpy-f6f4e0c4c9d9f8a9.js.map