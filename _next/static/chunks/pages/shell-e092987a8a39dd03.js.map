{"version":3,"file":"static/chunks/pages/shell-e092987a8a39dd03.js","mappings":"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","sources":["webpack://_N_E/?a5e0","webpack://_N_E/./src/components/terminal.tsx","webpack://_N_E/./src/pages/shell.tsx","webpack://_N_E/<anon>"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/shell\",\n      function () {\n        return require(\"private-next-pages/shell.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/shell\"])\n      });\n    }\n  ","// cspell: ignore scrollback\n\nimport { AdbSubprocessProtocol, encodeUtf8 } from \"@yume-chan/adb\";\nimport { AutoDisposable } from \"@yume-chan/event\";\nimport { AbortController, WritableStream } from '@yume-chan/stream-extra';\nimport { Terminal } from 'xterm';\nimport { FitAddon } from 'xterm-addon-fit';\nimport { SearchAddon } from 'xterm-addon-search';\nimport { WebglAddon } from 'xterm-addon-webgl';\n\nexport class AdbTerminal extends AutoDisposable {\n    private element = document.createElement('div');\n\n    public terminal: Terminal = new Terminal({\n        allowProposedApi: true,\n        allowTransparency: true,\n        cursorStyle: 'bar',\n        cursorBlink: true,\n        fontFamily: '\"Cascadia Code\", Consolas, monospace, \"Source Han Sans SC\", \"Microsoft YaHei\"',\n        letterSpacing: 1,\n        scrollback: 9000,\n        smoothScrollDuration: 50,\n        overviewRulerWidth: 20,\n    });\n\n    public searchAddon = new SearchAddon();\n\n    private readonly fitAddon = new FitAddon();\n\n    private _socket: AdbSubprocessProtocol | undefined;\n    private _socketAbortController: AbortController | undefined;\n    public get socket() { return this._socket; }\n    public set socket(value) {\n        if (this._socket) {\n            // Remove event listeners\n            this.dispose();\n            this._socketAbortController?.abort();\n        }\n\n        this._socket = value;\n\n        if (value) {\n            this.terminal.clear();\n            this.terminal.reset();\n\n            this._socketAbortController = new AbortController();\n\n            // pty mode only has one stream\n            value.stdout.pipeTo(new WritableStream<Uint8Array>({\n                write: (chunk) => {\n                    this.terminal.write(chunk);\n                },\n            }), {\n                signal: this._socketAbortController.signal,\n            });\n\n            const _writer = value.stdin.getWriter();\n            this.addDisposable(this.terminal.onData(data => {\n                const buffer = encodeUtf8(data);\n                _writer.write(buffer);\n            }));\n\n            this.fit();\n        }\n    }\n\n    public constructor() {\n        super();\n\n        this.element.style.width = '100%';\n        this.element.style.height = '100%';\n        this.element.style.overflow = 'hidden';\n\n        this.terminal.loadAddon(this.searchAddon);\n        this.terminal.loadAddon(this.fitAddon);\n    }\n\n    public setContainer(container: HTMLDivElement) {\n        container.appendChild(this.element);\n        if (!this.terminal.element) {\n            void this.element.offsetWidth;\n            this.terminal.open(this.element);\n            // WebGL addon requires terminal to be attached to DOM\n            this.terminal.loadAddon(new WebglAddon());\n            // WebGL renderer ignores `cursorBlink` set before it initialized\n            this.terminal.options.cursorBlink = true;\n            this.fit();\n        }\n    }\n\n    public fit() {\n        this.fitAddon.fit();\n        // Resize remote terminal\n        const { rows, cols } = this.terminal;\n        this._socket?.resize(rows, cols);\n    }\n}\n","import { IconButton, SearchBox, Stack, StackItem } from '@fluentui/react';\nimport { makeStyles, shorthands } from '@griffel/react';\nimport { action, autorun, makeAutoObservable, runInAction } from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport { NextPage } from \"next\";\nimport Head from \"next/head\";\nimport { useCallback, useEffect } from 'react';\nimport { ISearchOptions } from 'xterm-addon-search';\nimport 'xterm/css/xterm.css';\nimport { ResizeObserver } from '../components';\nimport { GlobalState } from \"../state\";\nimport { Icons, RouteStackProps } from '../utils';\n\nconst useClasses = makeStyles({\n    count: {\n        ...shorthands.padding('0', '8px'),\n    }\n});\n\nlet terminal: import('../components/terminal').AdbTerminal | undefined;\nif (typeof window !== 'undefined') {\n    const { AdbTerminal } = require('../components/terminal');\n    terminal = new AdbTerminal();\n}\n\nconst SEARCH_OPTIONS: ISearchOptions = {\n    decorations: {\n        matchBackground: '#42557b',\n        matchOverviewRuler: '#d18616',\n        activeMatchBackground: '#6199ff2f',\n        activeMatchColorOverviewRuler: '#d186167e'\n    }\n};\n\nconst state = makeAutoObservable({\n    visible: false,\n    index: undefined as number | undefined,\n    count: undefined as number | undefined,\n    setVisible(value: boolean) {\n        this.visible = value;\n    },\n\n    searchKeyword: '',\n    setSearchKeyword(value: string) {\n        this.searchKeyword = value;\n        terminal!.searchAddon.findNext(value, {\n            ...SEARCH_OPTIONS,\n            incremental: true,\n        });\n    },\n\n    searchPrevious() {\n        terminal!.searchAddon.findPrevious(this.searchKeyword, SEARCH_OPTIONS);\n    },\n    searchNext() {\n        terminal!.searchAddon.findNext(this.searchKeyword, SEARCH_OPTIONS);\n    }\n}, {\n    searchPrevious: action.bound,\n    searchNext: action.bound,\n});\n\nif (terminal) {\n    terminal.searchAddon.onDidChangeResults((e) => {\n        console.log(e);\n\n        runInAction(() => {\n            if (e) {\n                state.index = e.resultIndex;\n                state.count = e.resultCount;\n            } else {\n                state.index = undefined;\n                state.count = undefined;\n            }\n        });\n    });\n}\n\nautorun(() => {\n    if (!terminal) {\n        return;\n    }\n\n    if (!GlobalState.device) {\n        terminal.socket = undefined;\n        return;\n    }\n\n    if (!terminal.socket && state.visible) {\n        GlobalState.device.subprocess.shell()\n            .then(action(shell => {\n                terminal!.socket = shell;\n            }), (e) => {\n                GlobalState.showErrorDialog(e);\n            });\n    }\n});\n\nconst UpIconProps = { iconName: Icons.ChevronUp };\nconst DownIconProps = { iconName: Icons.ChevronDown };\n\nconst Shell: NextPage = (): JSX.Element | null => {\n    const classes = useClasses();\n\n    const handleSearchKeywordChange = useCallback((e: unknown, value?: string) => {\n        state.setSearchKeyword(value ?? '');\n    }, []);\n\n    const handleResize = useCallback(() => {\n        terminal!.fit();\n    }, []);\n\n    const handleContainerRef = useCallback((container: HTMLDivElement | null) => {\n        if (container) {\n            terminal!.setContainer(container);\n        }\n    }, []);\n\n    useEffect(() => {\n        state.setVisible(true);\n        return () => {\n            state.setVisible(false);\n        };\n    }, []);\n\n    return (\n        <Stack {...RouteStackProps}>\n            <Head>\n                <title>Interactive Shell - Android Web Toolbox</title>\n            </Head>\n\n            <StackItem>\n                <Stack horizontal>\n                    <StackItem grow>\n                        <SearchBox\n                            placeholder=\"Find\"\n                            value={state.searchKeyword}\n                            onChange={handleSearchKeywordChange}\n                            onSearch={state.searchNext}\n                        />\n                    </StackItem>\n                    {state.count === 0 ? (\n                        <StackItem className={classes.count} align=\"center\">\n                            No results\n                        </StackItem>\n                    ) : state.count !== undefined ? (\n                        <StackItem className={classes.count} align='center'>\n                            {state.index! + 1} of {state.count}\n                        </StackItem>\n                    ) : null}\n                    <StackItem>\n                        <IconButton\n                            disabled={!state.searchKeyword}\n                            iconProps={UpIconProps}\n                            onClick={state.searchPrevious}\n                        />\n                    </StackItem>\n                    <StackItem>\n                        <IconButton\n                            disabled={!state.searchKeyword}\n                            iconProps={DownIconProps}\n                            onClick={state.searchNext}\n                        />\n                    </StackItem>\n                </Stack>\n            </StackItem>\n\n            <StackItem grow styles={{ root: { position: 'relative', minHeight: 0 } }}>\n                <ResizeObserver onResize={handleResize} />\n                <div ref={handleContainerRef} style={{ height: '100%' }} />\n            </StackItem>\n        </Stack>\n    );\n};\n\nexport default observer(Shell);\n","(self[\"webpackChunk_N_E\"] = self[\"webpackChunk_N_E\"] || []).push([[236],{\n\n/***/ 5327:\n/***/ (function(__unused_webpack_module, __unused_webpack_exports, __webpack_require__) {\n\n\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/shell\",\n      function () {\n        return __webpack_require__(6825);\n      }\n    ]);\n    if(false) {}\n  \n\n/***/ }),\n\n/***/ 9939:\n/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"AdbTerminal\": function() { return /* binding */ AdbTerminal; }\n/* harmony export */ });\n/* harmony import */ var _yume_chan_adb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(7417);\n/* harmony import */ var _yume_chan_event__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(2469);\n/* harmony import */ var _yume_chan_stream_extra__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(6261);\n/* harmony import */ var xterm__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(8425);\n/* harmony import */ var xterm__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(xterm__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var xterm_addon_fit__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(8711);\n/* harmony import */ var xterm_addon_fit__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(xterm_addon_fit__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var xterm_addon_search__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(2923);\n/* harmony import */ var xterm_addon_search__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(xterm_addon_search__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var xterm_addon_webgl__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(8874);\n/* harmony import */ var xterm_addon_webgl__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(xterm_addon_webgl__WEBPACK_IMPORTED_MODULE_6__);\n// cspell: ignore scrollback\n\n\n\n\n\n\n\nclass AdbTerminal extends _yume_chan_event__WEBPACK_IMPORTED_MODULE_1__/* .AutoDisposable */ .Xn {\n    get socket() {\n        return this._socket;\n    }\n    set socket(value) {\n        if (this._socket) {\n            var ref;\n            // Remove event listeners\n            this.dispose();\n            (ref = this._socketAbortController) === null || ref === void 0 ? void 0 : ref.abort();\n        }\n        this._socket = value;\n        if (value) {\n            this.terminal.clear();\n            this.terminal.reset();\n            this._socketAbortController = new _yume_chan_stream_extra__WEBPACK_IMPORTED_MODULE_2__/* .AbortController */ .HS();\n            // pty mode only has one stream\n            value.stdout.pipeTo(new _yume_chan_stream_extra__WEBPACK_IMPORTED_MODULE_2__/* .WritableStream */ .Vj({\n                write: (chunk)=>{\n                    this.terminal.write(chunk);\n                }\n            }), {\n                signal: this._socketAbortController.signal\n            });\n            const _writer = value.stdin.getWriter();\n            this.addDisposable(this.terminal.onData((data)=>{\n                const buffer = (0,_yume_chan_adb__WEBPACK_IMPORTED_MODULE_0__/* .encodeUtf8 */ .lz)(data);\n                _writer.write(buffer);\n            }));\n            this.fit();\n        }\n    }\n    setContainer(container) {\n        container.appendChild(this.element);\n        if (!this.terminal.element) {\n            void this.element.offsetWidth;\n            this.terminal.open(this.element);\n            // WebGL addon requires terminal to be attached to DOM\n            this.terminal.loadAddon(new xterm_addon_webgl__WEBPACK_IMPORTED_MODULE_6__.WebglAddon());\n            // WebGL renderer ignores `cursorBlink` set before it initialized\n            this.terminal.options.cursorBlink = true;\n            this.fit();\n        }\n    }\n    fit() {\n        var ref;\n        this.fitAddon.fit();\n        // Resize remote terminal\n        const { rows , cols  } = this.terminal;\n        (ref = this._socket) === null || ref === void 0 ? void 0 : ref.resize(rows, cols);\n    }\n    constructor(){\n        super();\n        this.element = document.createElement(\"div\");\n        this.terminal = new xterm__WEBPACK_IMPORTED_MODULE_3__.Terminal({\n            allowProposedApi: true,\n            allowTransparency: true,\n            cursorStyle: \"bar\",\n            cursorBlink: true,\n            fontFamily: '\"Cascadia Code\", Consolas, monospace, \"Source Han Sans SC\", \"Microsoft YaHei\"',\n            letterSpacing: 1,\n            scrollback: 9000,\n            smoothScrollDuration: 50,\n            overviewRulerWidth: 20\n        });\n        this.searchAddon = new xterm_addon_search__WEBPACK_IMPORTED_MODULE_5__.SearchAddon();\n        this.fitAddon = new xterm_addon_fit__WEBPACK_IMPORTED_MODULE_4__.FitAddon();\n        this.element.style.width = \"100%\";\n        this.element.style.height = \"100%\";\n        this.element.style.overflow = \"hidden\";\n        this.terminal.loadAddon(this.searchAddon);\n        this.terminal.loadAddon(this.fitAddon);\n    }\n}\n\n\n/***/ }),\n\n/***/ 6825:\n/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(4471);\n/* harmony import */ var _fluentui_react__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(1887);\n/* harmony import */ var _fluentui_react__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(9899);\n/* harmony import */ var _fluentui_react__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(7162);\n/* harmony import */ var _fluentui_react__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(1197);\n/* harmony import */ var _griffel_react__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(9332);\n/* harmony import */ var _griffel_react__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(8186);\n/* harmony import */ var mobx__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(6323);\n/* harmony import */ var mobx_react_lite__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(6779);\n/* harmony import */ var next_head__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(3591);\n/* harmony import */ var next_head__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_head__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(3370);\n/* harmony import */ var xterm_css_xterm_css__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(1714);\n/* harmony import */ var xterm_css_xterm_css__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(xterm_css_xterm_css__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var _components__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(4347);\n/* harmony import */ var _state__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(2344);\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(5155);\n\n\n\n\n\n\n\n\n\n\n\nconst useClasses = (0,_griffel_react__WEBPACK_IMPORTED_MODULE_8__/* .makeStyles */ .Z)({\n    count: {\n        ..._griffel_react__WEBPACK_IMPORTED_MODULE_9__/* .shorthands.padding */ .q5.padding(\"0\", \"8px\")\n    }\n});\nlet terminal;\nif (true) {\n    const { AdbTerminal  } = __webpack_require__(9939);\n    terminal = new AdbTerminal();\n}\nconst SEARCH_OPTIONS = {\n    decorations: {\n        matchBackground: \"#42557b\",\n        matchOverviewRuler: \"#d18616\",\n        activeMatchBackground: \"#6199ff2f\",\n        activeMatchColorOverviewRuler: \"#d186167e\"\n    }\n};\nconst state = (0,mobx__WEBPACK_IMPORTED_MODULE_10__/* .makeAutoObservable */ .ky)({\n    visible: false,\n    index: undefined,\n    count: undefined,\n    setVisible (value) {\n        this.visible = value;\n    },\n    searchKeyword: \"\",\n    setSearchKeyword (value) {\n        this.searchKeyword = value;\n        terminal.searchAddon.findNext(value, {\n            ...SEARCH_OPTIONS,\n            incremental: true\n        });\n    },\n    searchPrevious () {\n        terminal.searchAddon.findPrevious(this.searchKeyword, SEARCH_OPTIONS);\n    },\n    searchNext () {\n        terminal.searchAddon.findNext(this.searchKeyword, SEARCH_OPTIONS);\n    }\n}, {\n    searchPrevious: mobx__WEBPACK_IMPORTED_MODULE_10__/* .action.bound */ .aD.bound,\n    searchNext: mobx__WEBPACK_IMPORTED_MODULE_10__/* .action.bound */ .aD.bound\n});\nif (terminal) {\n    terminal.searchAddon.onDidChangeResults((e)=>{\n        console.log(e);\n        (0,mobx__WEBPACK_IMPORTED_MODULE_10__/* .runInAction */ .z)(()=>{\n            if (e) {\n                state.index = e.resultIndex;\n                state.count = e.resultCount;\n            } else {\n                state.index = undefined;\n                state.count = undefined;\n            }\n        });\n    });\n}\n(0,mobx__WEBPACK_IMPORTED_MODULE_10__/* .autorun */ .EH)(()=>{\n    if (!terminal) {\n        return;\n    }\n    if (!_state__WEBPACK_IMPORTED_MODULE_6__/* .GlobalState.device */ .q.device) {\n        terminal.socket = undefined;\n        return;\n    }\n    if (!terminal.socket && state.visible) {\n        _state__WEBPACK_IMPORTED_MODULE_6__/* .GlobalState.device.subprocess.shell */ .q.device.subprocess.shell().then((0,mobx__WEBPACK_IMPORTED_MODULE_10__/* .action */ .aD)((shell)=>{\n            terminal.socket = shell;\n        }), (e)=>{\n            _state__WEBPACK_IMPORTED_MODULE_6__/* .GlobalState.showErrorDialog */ .q.showErrorDialog(e);\n        });\n    }\n});\nconst UpIconProps = {\n    iconName: _utils__WEBPACK_IMPORTED_MODULE_7__/* .Icons.ChevronUp */ .PJ.ChevronUp\n};\nconst DownIconProps = {\n    iconName: _utils__WEBPACK_IMPORTED_MODULE_7__/* .Icons.ChevronDown */ .PJ.ChevronDown\n};\nconst Shell = ()=>{\n    const classes = useClasses();\n    const handleSearchKeywordChange = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)((e, value)=>{\n        state.setSearchKeyword(value !== null && value !== void 0 ? value : \"\");\n    }, []);\n    const handleResize = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)(()=>{\n        terminal.fit();\n    }, []);\n    const handleContainerRef = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)((container)=>{\n        if (container) {\n            terminal.setContainer(container);\n        }\n    }, []);\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(()=>{\n        state.setVisible(true);\n        return ()=>{\n            state.setVisible(false);\n        };\n    }, []);\n    return /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_fluentui_react__WEBPACK_IMPORTED_MODULE_11__/* .Stack */ .K, {\n        ..._utils__WEBPACK_IMPORTED_MODULE_7__/* .RouteStackProps */ .LE,\n        children: [\n            /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)((next_head__WEBPACK_IMPORTED_MODULE_2___default()), {\n                children: /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"title\", {\n                    children: \"Interactive Shell - Android Web Toolbox\"\n                })\n            }),\n            /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_fluentui_react__WEBPACK_IMPORTED_MODULE_12__/* .StackItem */ .v, {\n                children: /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_fluentui_react__WEBPACK_IMPORTED_MODULE_11__/* .Stack */ .K, {\n                    horizontal: true,\n                    children: [\n                        /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_fluentui_react__WEBPACK_IMPORTED_MODULE_12__/* .StackItem */ .v, {\n                            grow: true,\n                            children: /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_fluentui_react__WEBPACK_IMPORTED_MODULE_13__/* .SearchBox */ .R, {\n                                placeholder: \"Find\",\n                                value: state.searchKeyword,\n                                onChange: handleSearchKeywordChange,\n                                onSearch: state.searchNext\n                            })\n                        }),\n                        state.count === 0 ? /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_fluentui_react__WEBPACK_IMPORTED_MODULE_12__/* .StackItem */ .v, {\n                            className: classes.count,\n                            align: \"center\",\n                            children: \"No results\"\n                        }) : state.count !== undefined ? /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_fluentui_react__WEBPACK_IMPORTED_MODULE_12__/* .StackItem */ .v, {\n                            className: classes.count,\n                            align: \"center\",\n                            children: [\n                                state.index + 1,\n                                \" of \",\n                                state.count\n                            ]\n                        }) : null,\n                        /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_fluentui_react__WEBPACK_IMPORTED_MODULE_12__/* .StackItem */ .v, {\n                            children: /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_fluentui_react__WEBPACK_IMPORTED_MODULE_14__/* .IconButton */ .h, {\n                                disabled: !state.searchKeyword,\n                                iconProps: UpIconProps,\n                                onClick: state.searchPrevious\n                            })\n                        }),\n                        /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_fluentui_react__WEBPACK_IMPORTED_MODULE_12__/* .StackItem */ .v, {\n                            children: /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_fluentui_react__WEBPACK_IMPORTED_MODULE_14__/* .IconButton */ .h, {\n                                disabled: !state.searchKeyword,\n                                iconProps: DownIconProps,\n                                onClick: state.searchNext\n                            })\n                        })\n                    ]\n                })\n            }),\n            /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_fluentui_react__WEBPACK_IMPORTED_MODULE_12__/* .StackItem */ .v, {\n                grow: true,\n                styles: {\n                    root: {\n                        position: \"relative\",\n                        minHeight: 0\n                    }\n                },\n                children: [\n                    /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components__WEBPACK_IMPORTED_MODULE_5__/* .ResizeObserver */ [\"do\"], {\n                        onResize: handleResize\n                    }),\n                    /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\n                        ref: handleContainerRef,\n                        style: {\n                            height: \"100%\"\n                        }\n                    })\n                ]\n            })\n        ]\n    });\n};\n/* harmony default export */ __webpack_exports__[\"default\"] = ((0,mobx_react_lite__WEBPACK_IMPORTED_MODULE_1__/* .observer */ .Pi)(Shell));\n\n\n/***/ })\n\n},\n/******/ function(__webpack_require__) { // webpackRuntimeModules\n/******/ var __webpack_exec__ = function(moduleId) { return __webpack_require__(__webpack_require__.s = moduleId); }\n/******/ __webpack_require__.O(0, [470,447,774,888,179], function() { return __webpack_exec__(5327); });\n/******/ var __webpack_exports__ = __webpack_require__.O();\n/******/ _N_E = __webpack_exports__;\n/******/ }\n]);"],"names":["self","push","__unused_webpack_module","__unused_webpack_exports","__webpack_require__","window","__NEXT_P","__webpack_exports__","r","d","AdbTerminal","_yume_chan_adb__WEBPACK_IMPORTED_MODULE_0__","_yume_chan_event__WEBPACK_IMPORTED_MODULE_1__","_yume_chan_stream_extra__WEBPACK_IMPORTED_MODULE_2__","xterm__WEBPACK_IMPORTED_MODULE_3__","xterm_addon_fit__WEBPACK_IMPORTED_MODULE_4__","xterm_addon_search__WEBPACK_IMPORTED_MODULE_5__","xterm_addon_webgl__WEBPACK_IMPORTED_MODULE_6__","Xn","socket","_socket","value","ref","dispose","_socketAbortController","abort","terminal","clear","reset","HS","stdout","pipeTo","Vj","write","chunk","signal","_writer","stdin","getWriter","addDisposable","onData","buffer","lz","data","fit","setContainer","container","appendChild","element","offsetWidth","open","loadAddon","WebglAddon","options","cursorBlink","fitAddon","rows","cols","resize","constructor","document","createElement","Terminal","allowProposedApi","allowTransparency","cursorStyle","fontFamily","letterSpacing","scrollback","smoothScrollDuration","overviewRulerWidth","searchAddon","SearchAddon","FitAddon","style","width","height","overflow","react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__","_fluentui_react__WEBPACK_IMPORTED_MODULE_11__","_fluentui_react__WEBPACK_IMPORTED_MODULE_12__","_fluentui_react__WEBPACK_IMPORTED_MODULE_13__","_fluentui_react__WEBPACK_IMPORTED_MODULE_14__","_griffel_react__WEBPACK_IMPORTED_MODULE_8__","_griffel_react__WEBPACK_IMPORTED_MODULE_9__","mobx__WEBPACK_IMPORTED_MODULE_10__","mobx_react_lite__WEBPACK_IMPORTED_MODULE_1__","next_head__WEBPACK_IMPORTED_MODULE_2__","next_head__WEBPACK_IMPORTED_MODULE_2___default","n","react__WEBPACK_IMPORTED_MODULE_3__","_components__WEBPACK_IMPORTED_MODULE_5__","_state__WEBPACK_IMPORTED_MODULE_6__","_utils__WEBPACK_IMPORTED_MODULE_7__","useClasses","Z","count","q5","padding","SEARCH_OPTIONS","decorations","matchBackground","matchOverviewRuler","activeMatchBackground","activeMatchColorOverviewRuler","state","ky","visible","index","undefined","setVisible","searchKeyword","setSearchKeyword","findNext","incremental","searchPrevious","findPrevious","searchNext","aD","bound","onDidChangeResults","console","log","e","z","resultIndex","resultCount","EH","q","device","subprocess","shell","then","showErrorDialog","UpIconProps","iconName","PJ","ChevronUp","DownIconProps","ChevronDown","Shell","classes","handleSearchKeywordChange","useCallback","handleResize","handleContainerRef","useEffect","jsxs","K","LE","children","jsx","v","horizontal","grow","R","placeholder","onChange","onSearch","className","align","h","disabled","iconProps","onClick","styles","root","position","minHeight","onResize","Pi","O","s","_N_E"],"sourceRoot":""}