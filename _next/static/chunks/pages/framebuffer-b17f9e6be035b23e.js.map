{"version":3,"file":"static/chunks/pages/framebuffer-b17f9e6be035b23e.js","mappings":"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","sources":["webpack://_N_E/?d7c6","webpack://_N_E/./src/pages/framebuffer.tsx","webpack://_N_E/<anon>"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/framebuffer\",\n      function () {\n        return require(\"private-next-pages/framebuffer.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/framebuffer\"])\n      });\n    }\n  ","import { ICommandBarItemProps, Stack } from '@fluentui/react';\nimport { AdbFrameBuffer } from \"@yume-chan/adb\";\nimport { action, autorun, computed, makeAutoObservable } from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport { NextPage } from \"next\";\nimport Head from \"next/head\";\nimport { useCallback, useEffect, useRef } from 'react';\nimport { CommandBar, DemoModePanel, DeviceView } from '../components';\nimport { GlobalState } from \"../state\";\nimport { Icons, RouteStackProps } from \"../utils\";\n\nclass FrameBufferState {\n    width = 0;\n    height = 0;\n    imageData: ImageData | undefined = undefined;\n    demoModeVisible = false;\n\n    constructor() {\n        makeAutoObservable(this, {\n            toggleDemoModeVisible: action.bound,\n        });\n    }\n\n    setImage(image: AdbFrameBuffer) {\n        this.width = image.width;\n        this.height = image.height;\n        this.imageData = new ImageData(new Uint8ClampedArray(image.data), image.width, image.height);\n    }\n\n    toggleDemoModeVisible() {\n        this.demoModeVisible = !this.demoModeVisible;\n    }\n}\n\nconst state = new FrameBufferState();\n\nconst FrameBuffer: NextPage = (): JSX.Element | null => {\n    const canvasRef = useRef<HTMLCanvasElement | null>(null);\n\n    const capture = useCallback(async () => {\n        if (!GlobalState.device) {\n            return;\n        }\n\n        try {\n            const framebuffer = await GlobalState.device.framebuffer();\n            state.setImage(framebuffer);\n        } catch (e: any) {\n            GlobalState.showErrorDialog(e);\n        }\n    }, []);\n\n    useEffect(() => {\n        return autorun(() => {\n            const canvas = canvasRef.current;\n            if (canvas && state.imageData) {\n                canvas.width = state.width;\n                canvas.height = state.height;\n                const context = canvas.getContext(\"2d\")!;\n                context.putImageData(state.imageData, 0, 0);\n            }\n        });\n    }, []);\n\n    const commandBarItems = computed(() => [\n        {\n            key: 'start',\n            disabled: !GlobalState.device,\n            iconProps: { iconName: Icons.Camera, style: { height: 20, fontSize: 20, lineHeight: 1.5 } },\n            text: 'Capture',\n            onClick: capture,\n        },\n        {\n            key: 'Save',\n            disabled: !state.imageData,\n            iconProps: { iconName: Icons.Save, style: { height: 20, fontSize: 20, lineHeight: 1.5 } },\n            text: 'Save',\n            onClick: () => {\n                const canvas = canvasRef.current;\n                if (!canvas) {\n                    return;\n                }\n\n                const url = canvas.toDataURL();\n                const a = document.createElement('a');\n                a.href = url;\n                a.download = `Screenshot of ${GlobalState.backend!.name}.png`;\n                a.click();\n            },\n        },\n    ]);\n\n    const commandBarFarItems = computed((): ICommandBarItemProps[] => [\n        {\n            key: 'DemoMode',\n            iconProps: { iconName: Icons.Wand, style: { height: 20, fontSize: 20, lineHeight: 1.5 } },\n            checked: state.demoModeVisible,\n            text: 'Demo Mode',\n            onClick: state.toggleDemoModeVisible,\n        },\n        {\n            key: 'info',\n            iconProps: { iconName: Icons.Info, style: { height: 20, fontSize: 20, lineHeight: 1.5 } },\n            iconOnly: true,\n            tooltipHostProps: {\n                content: 'Use ADB FrameBuffer command to capture a full-size, high-resolution screenshot.',\n                calloutProps: {\n                    calloutMaxWidth: 250,\n                }\n            },\n        }\n    ]);\n\n    return (\n        <Stack {...RouteStackProps}>\n            <Head>\n                <title>Screen Capture - Android Web Toolbox</title>\n            </Head>\n\n            <CommandBar items={commandBarItems.get()} farItems={commandBarFarItems.get()} />\n            <Stack horizontal grow styles={{ root: { height: 0 } }}>\n                <DeviceView width={state.width} height={state.height}>\n                    <canvas ref={canvasRef} style={{ display: 'block' }} />\n                </DeviceView>\n\n                <DemoModePanel style={{ display: state.demoModeVisible ? 'block' : 'none' }} />\n            </Stack>\n        </Stack>\n    );\n};\n\nexport default observer(FrameBuffer);\n","(self[\"webpackChunk_N_E\"] = self[\"webpackChunk_N_E\"] || []).push([[390],{\n\n/***/ 8722:\n/***/ (function(__unused_webpack_module, __unused_webpack_exports, __webpack_require__) {\n\n\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/framebuffer\",\n      function () {\n        return __webpack_require__(7395);\n      }\n    ]);\n    if(false) {}\n  \n\n/***/ }),\n\n/***/ 7395:\n/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(4471);\n/* harmony import */ var _fluentui_react__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(1887);\n/* harmony import */ var mobx__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(6323);\n/* harmony import */ var mobx_react_lite__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(6779);\n/* harmony import */ var next_head__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(3591);\n/* harmony import */ var next_head__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_head__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(3370);\n/* harmony import */ var _components__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(4347);\n/* harmony import */ var _state__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(2344);\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(5155);\n\n\n\n\n\n\n\n\n\nclass FrameBufferState {\n    setImage(image) {\n        this.width = image.width;\n        this.height = image.height;\n        this.imageData = new ImageData(new Uint8ClampedArray(image.data), image.width, image.height);\n    }\n    toggleDemoModeVisible() {\n        this.demoModeVisible = !this.demoModeVisible;\n    }\n    constructor(){\n        this.width = 0;\n        this.height = 0;\n        this.imageData = undefined;\n        this.demoModeVisible = false;\n        (0,mobx__WEBPACK_IMPORTED_MODULE_7__/* .makeAutoObservable */ .ky)(this, {\n            toggleDemoModeVisible: mobx__WEBPACK_IMPORTED_MODULE_7__/* .action.bound */ .aD.bound\n        });\n    }\n}\nconst state = new FrameBufferState();\nconst FrameBuffer = ()=>{\n    const canvasRef = (0,react__WEBPACK_IMPORTED_MODULE_3__.useRef)(null);\n    const capture = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)(async ()=>{\n        if (!_state__WEBPACK_IMPORTED_MODULE_5__/* .GlobalState.device */ .q.device) {\n            return;\n        }\n        try {\n            const framebuffer = await _state__WEBPACK_IMPORTED_MODULE_5__/* .GlobalState.device.framebuffer */ .q.device.framebuffer();\n            state.setImage(framebuffer);\n        } catch (e) {\n            _state__WEBPACK_IMPORTED_MODULE_5__/* .GlobalState.showErrorDialog */ .q.showErrorDialog(e);\n        }\n    }, []);\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(()=>{\n        return (0,mobx__WEBPACK_IMPORTED_MODULE_7__/* .autorun */ .EH)(()=>{\n            const canvas = canvasRef.current;\n            if (canvas && state.imageData) {\n                canvas.width = state.width;\n                canvas.height = state.height;\n                const context = canvas.getContext(\"2d\");\n                context.putImageData(state.imageData, 0, 0);\n            }\n        });\n    }, []);\n    const commandBarItems = (0,mobx__WEBPACK_IMPORTED_MODULE_7__/* .computed */ .Fl)(()=>[\n            {\n                key: \"start\",\n                disabled: !_state__WEBPACK_IMPORTED_MODULE_5__/* .GlobalState.device */ .q.device,\n                iconProps: {\n                    iconName: _utils__WEBPACK_IMPORTED_MODULE_6__/* .Icons.Camera */ .PJ.Camera,\n                    style: {\n                        height: 20,\n                        fontSize: 20,\n                        lineHeight: 1.5\n                    }\n                },\n                text: \"Capture\",\n                onClick: capture\n            },\n            {\n                key: \"Save\",\n                disabled: !state.imageData,\n                iconProps: {\n                    iconName: _utils__WEBPACK_IMPORTED_MODULE_6__/* .Icons.Save */ .PJ.Save,\n                    style: {\n                        height: 20,\n                        fontSize: 20,\n                        lineHeight: 1.5\n                    }\n                },\n                text: \"Save\",\n                onClick: ()=>{\n                    const canvas = canvasRef.current;\n                    if (!canvas) {\n                        return;\n                    }\n                    const url = canvas.toDataURL();\n                    const a = document.createElement(\"a\");\n                    a.href = url;\n                    a.download = \"Screenshot of \".concat(_state__WEBPACK_IMPORTED_MODULE_5__/* .GlobalState.backend.name */ .q.backend.name, \".png\");\n                    a.click();\n                }\n            }\n        ]);\n    const commandBarFarItems = (0,mobx__WEBPACK_IMPORTED_MODULE_7__/* .computed */ .Fl)(()=>[\n            {\n                key: \"DemoMode\",\n                iconProps: {\n                    iconName: _utils__WEBPACK_IMPORTED_MODULE_6__/* .Icons.Wand */ .PJ.Wand,\n                    style: {\n                        height: 20,\n                        fontSize: 20,\n                        lineHeight: 1.5\n                    }\n                },\n                checked: state.demoModeVisible,\n                text: \"Demo Mode\",\n                onClick: state.toggleDemoModeVisible\n            },\n            {\n                key: \"info\",\n                iconProps: {\n                    iconName: _utils__WEBPACK_IMPORTED_MODULE_6__/* .Icons.Info */ .PJ.Info,\n                    style: {\n                        height: 20,\n                        fontSize: 20,\n                        lineHeight: 1.5\n                    }\n                },\n                iconOnly: true,\n                tooltipHostProps: {\n                    content: \"Use ADB FrameBuffer command to capture a full-size, high-resolution screenshot.\",\n                    calloutProps: {\n                        calloutMaxWidth: 250\n                    }\n                }\n            }\n        ]);\n    return /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_fluentui_react__WEBPACK_IMPORTED_MODULE_8__/* .Stack */ .K, {\n        ..._utils__WEBPACK_IMPORTED_MODULE_6__/* .RouteStackProps */ .LE,\n        children: [\n            /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)((next_head__WEBPACK_IMPORTED_MODULE_2___default()), {\n                children: /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"title\", {\n                    children: \"Screen Capture - Android Web Toolbox\"\n                })\n            }),\n            /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components__WEBPACK_IMPORTED_MODULE_4__/* .CommandBar */ .X3, {\n                items: commandBarItems.get(),\n                farItems: commandBarFarItems.get()\n            }),\n            /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_fluentui_react__WEBPACK_IMPORTED_MODULE_8__/* .Stack */ .K, {\n                horizontal: true,\n                grow: true,\n                styles: {\n                    root: {\n                        height: 0\n                    }\n                },\n                children: [\n                    /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components__WEBPACK_IMPORTED_MODULE_4__/* .DeviceView */ .wM, {\n                        width: state.width,\n                        height: state.height,\n                        children: /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"canvas\", {\n                            ref: canvasRef,\n                            style: {\n                                display: \"block\"\n                            }\n                        })\n                    }),\n                    /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components__WEBPACK_IMPORTED_MODULE_4__/* .DemoModePanel */ .bq, {\n                        style: {\n                            display: state.demoModeVisible ? \"block\" : \"none\"\n                        }\n                    })\n                ]\n            })\n        ]\n    });\n};\n/* harmony default export */ __webpack_exports__[\"default\"] = ((0,mobx_react_lite__WEBPACK_IMPORTED_MODULE_1__/* .observer */ .Pi)(FrameBuffer));\n\n\n/***/ })\n\n},\n/******/ function(__webpack_require__) { // webpackRuntimeModules\n/******/ var __webpack_exec__ = function(moduleId) { return __webpack_require__(__webpack_require__.s = moduleId); }\n/******/ __webpack_require__.O(0, [774,888,179], function() { return __webpack_exec__(8722); });\n/******/ var __webpack_exports__ = __webpack_require__.O();\n/******/ _N_E = __webpack_exports__;\n/******/ }\n]);"],"names":["self","push","__unused_webpack_module","__unused_webpack_exports","__webpack_require__","window","__NEXT_P","__webpack_exports__","r","react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__","_fluentui_react__WEBPACK_IMPORTED_MODULE_8__","mobx__WEBPACK_IMPORTED_MODULE_7__","mobx_react_lite__WEBPACK_IMPORTED_MODULE_1__","next_head__WEBPACK_IMPORTED_MODULE_2__","next_head__WEBPACK_IMPORTED_MODULE_2___default","n","react__WEBPACK_IMPORTED_MODULE_3__","_components__WEBPACK_IMPORTED_MODULE_4__","_state__WEBPACK_IMPORTED_MODULE_5__","_utils__WEBPACK_IMPORTED_MODULE_6__","state","setImage","image","width","height","imageData","ImageData","Uint8ClampedArray","data","toggleDemoModeVisible","demoModeVisible","constructor","undefined","ky","aD","bound","FrameBuffer","canvasRef","useRef","capture","useCallback","q","device","framebuffer","e","showErrorDialog","useEffect","EH","canvas","current","context","getContext","putImageData","commandBarItems","Fl","key","disabled","iconProps","iconName","PJ","Camera","style","fontSize","lineHeight","text","onClick","Save","url","toDataURL","a","document","createElement","href","download","concat","backend","name","click","commandBarFarItems","Wand","checked","Info","iconOnly","tooltipHostProps","content","calloutProps","calloutMaxWidth","jsxs","K","LE","children","jsx","X3","items","get","farItems","horizontal","grow","styles","root","wM","ref","display","bq","Pi","O","s","_N_E"],"sourceRoot":""}