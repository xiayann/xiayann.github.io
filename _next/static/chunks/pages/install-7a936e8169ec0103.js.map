{"version":3,"file":"static/chunks/pages/install-7a936e8169ec0103.js","mappings":"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","sources":["webpack://_N_E/?b0cd","webpack://_N_E/./src/pages/install.tsx","webpack://_N_E/<anon>"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/install\",\n      function () {\n        return require(\"private-next-pages/install.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/install\"])\n      });\n    }\n  ","import { DefaultButton, ProgressIndicator, Stack } from \"@fluentui/react\";\nimport { ADB_SYNC_MAX_PACKET_SIZE } from \"@yume-chan/adb\";\nimport { ChunkStream } from '@yume-chan/stream-extra';\nimport { action, makeAutoObservable, observable, runInAction } from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport { NextPage } from \"next\";\nimport Head from \"next/head\";\nimport { GlobalState } from \"../state\";\nimport { createFileStream, pickFile, ProgressStream, RouteStackProps } from \"../utils\";\n\nenum Stage {\n    Uploading,\n\n    Installing,\n\n    Completed,\n}\n\ninterface Progress {\n    filename: string;\n\n    stage: Stage;\n\n    uploadedSize: number;\n\n    totalSize: number;\n\n    value: number | undefined;\n}\n\nclass InstallPageState {\n    installing = false;\n\n    progress: Progress | undefined = undefined;\n\n    constructor() {\n        makeAutoObservable(this, {\n            progress: observable.ref,\n            install: false,\n        });\n    }\n\n    install = async () => {\n        const file = await pickFile({ accept: '.apk' });\n        if (!file) {\n            return;\n        }\n\n        runInAction(() => {\n            this.installing = true;\n            this.progress = {\n                filename: file.name,\n                stage: Stage.Uploading,\n                uploadedSize: 0,\n                totalSize: file.size,\n                value: 0,\n            };\n        });\n\n        await createFileStream(file)\n            .pipeThrough(new ChunkStream(ADB_SYNC_MAX_PACKET_SIZE))\n            .pipeThrough(new ProgressStream(action((uploaded) => {\n                if (uploaded !== file.size) {\n                    this.progress = {\n                        filename: file.name,\n                        stage: Stage.Uploading,\n                        uploadedSize: uploaded,\n                        totalSize: file.size,\n                        value: uploaded / file.size * 0.8,\n                    };\n                } else {\n                    this.progress = {\n                        filename: file.name,\n                        stage: Stage.Installing,\n                        uploadedSize: uploaded,\n                        totalSize: file.size,\n                        value: 0.8,\n                    };\n                }\n            })))\n            .pipeTo(GlobalState.device!.install());\n\n        runInAction(() => {\n            this.progress = {\n                filename: file.name,\n                stage: Stage.Completed,\n                uploadedSize: file.size,\n                totalSize: file.size,\n                value: 1,\n            };\n            this.installing = false;\n        });\n    };\n}\n\nconst state = new InstallPageState();\n\nconst Install: NextPage = () => {\n    return (\n        <Stack {...RouteStackProps}>\n            <Head>\n                <title>Install APK - Android Web Toolbox</title>\n            </Head>\n\n            <Stack horizontal>\n                <DefaultButton\n                    disabled={!GlobalState.device || state.installing}\n                    text=\"Open\"\n                    onClick={state.install}\n                />\n            </Stack>\n\n            {state.progress && (\n                <ProgressIndicator\n                    styles={{ root: { width: 300 } }}\n                    label={state.progress.filename}\n                    percentComplete={state.progress.value}\n                    description={Stage[state.progress.stage]}\n                />\n            )}\n        </Stack>\n    );\n};\n\nexport default observer(Install);\n","(self[\"webpackChunk_N_E\"] = self[\"webpackChunk_N_E\"] || []).push([[768],{\n\n/***/ 7425:\n/***/ (function(__unused_webpack_module, __unused_webpack_exports, __webpack_require__) {\n\n\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/install\",\n      function () {\n        return __webpack_require__(1528);\n      }\n    ]);\n    if(false) {}\n  \n\n/***/ }),\n\n/***/ 1528:\n/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(4471);\n/* harmony import */ var _fluentui_react__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(1887);\n/* harmony import */ var _fluentui_react__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(4315);\n/* harmony import */ var _fluentui_react__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(7520);\n/* harmony import */ var _yume_chan_adb__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(7417);\n/* harmony import */ var _yume_chan_stream_extra__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(6261);\n/* harmony import */ var mobx__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(6323);\n/* harmony import */ var mobx_react_lite__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(6779);\n/* harmony import */ var next_head__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(3591);\n/* harmony import */ var next_head__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(next_head__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var _state__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(2344);\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(5155);\n\n\n\n\n\n\n\n\n\nvar Stage;\n(function(Stage) {\n    Stage[Stage[\"Uploading\"] = 0] = \"Uploading\";\n    Stage[Stage[\"Installing\"] = 1] = \"Installing\";\n    Stage[Stage[\"Completed\"] = 2] = \"Completed\";\n})(Stage || (Stage = {}));\nclass InstallPageState {\n    constructor(){\n        this.installing = false;\n        this.progress = undefined;\n        this.install = async ()=>{\n            const file = await (0,_utils__WEBPACK_IMPORTED_MODULE_6__/* .pickFile */ .oT)({\n                accept: \".apk\"\n            });\n            if (!file) {\n                return;\n            }\n            (0,mobx__WEBPACK_IMPORTED_MODULE_7__/* .runInAction */ .z)(()=>{\n                this.installing = true;\n                this.progress = {\n                    filename: file.name,\n                    stage: Stage.Uploading,\n                    uploadedSize: 0,\n                    totalSize: file.size,\n                    value: 0\n                };\n            });\n            await (0,_utils__WEBPACK_IMPORTED_MODULE_6__/* .createFileStream */ .Xd)(file).pipeThrough(new _yume_chan_stream_extra__WEBPACK_IMPORTED_MODULE_2__/* .ChunkStream */ .Cc(_yume_chan_adb__WEBPACK_IMPORTED_MODULE_1__/* .ADB_SYNC_MAX_PACKET_SIZE */ .j4)).pipeThrough(new _utils__WEBPACK_IMPORTED_MODULE_6__/* .ProgressStream */ .hK((0,mobx__WEBPACK_IMPORTED_MODULE_7__/* .action */ .aD)((uploaded)=>{\n                if (uploaded !== file.size) {\n                    this.progress = {\n                        filename: file.name,\n                        stage: Stage.Uploading,\n                        uploadedSize: uploaded,\n                        totalSize: file.size,\n                        value: uploaded / file.size * 0.8\n                    };\n                } else {\n                    this.progress = {\n                        filename: file.name,\n                        stage: Stage.Installing,\n                        uploadedSize: uploaded,\n                        totalSize: file.size,\n                        value: 0.8\n                    };\n                }\n            }))).pipeTo(_state__WEBPACK_IMPORTED_MODULE_5__/* .GlobalState.device.install */ .q.device.install());\n            (0,mobx__WEBPACK_IMPORTED_MODULE_7__/* .runInAction */ .z)(()=>{\n                this.progress = {\n                    filename: file.name,\n                    stage: Stage.Completed,\n                    uploadedSize: file.size,\n                    totalSize: file.size,\n                    value: 1\n                };\n                this.installing = false;\n            });\n        };\n        (0,mobx__WEBPACK_IMPORTED_MODULE_7__/* .makeAutoObservable */ .ky)(this, {\n            progress: mobx__WEBPACK_IMPORTED_MODULE_7__/* .observable.ref */ .LO.ref,\n            install: false\n        });\n    }\n}\nconst state = new InstallPageState();\nconst Install = ()=>{\n    return /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_fluentui_react__WEBPACK_IMPORTED_MODULE_8__/* .Stack */ .K, {\n        ..._utils__WEBPACK_IMPORTED_MODULE_6__/* .RouteStackProps */ .LE,\n        children: [\n            /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)((next_head__WEBPACK_IMPORTED_MODULE_4___default()), {\n                children: /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"title\", {\n                    children: \"Install APK - Android Web Toolbox\"\n                })\n            }),\n            /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_fluentui_react__WEBPACK_IMPORTED_MODULE_8__/* .Stack */ .K, {\n                horizontal: true,\n                children: /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_fluentui_react__WEBPACK_IMPORTED_MODULE_9__/* .DefaultButton */ .a, {\n                    disabled: !_state__WEBPACK_IMPORTED_MODULE_5__/* .GlobalState.device */ .q.device || state.installing,\n                    text: \"Open\",\n                    onClick: state.install\n                })\n            }),\n            state.progress && /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_fluentui_react__WEBPACK_IMPORTED_MODULE_10__/* .ProgressIndicator */ .Y, {\n                styles: {\n                    root: {\n                        width: 300\n                    }\n                },\n                label: state.progress.filename,\n                percentComplete: state.progress.value,\n                description: Stage[state.progress.stage]\n            })\n        ]\n    });\n};\n/* harmony default export */ __webpack_exports__[\"default\"] = ((0,mobx_react_lite__WEBPACK_IMPORTED_MODULE_3__/* .observer */ .Pi)(Install));\n\n\n/***/ })\n\n},\n/******/ function(__webpack_require__) { // webpackRuntimeModules\n/******/ var __webpack_exec__ = function(moduleId) { return __webpack_require__(__webpack_require__.s = moduleId); }\n/******/ __webpack_require__.O(0, [774,888,179], function() { return __webpack_exec__(7425); });\n/******/ var __webpack_exports__ = __webpack_require__.O();\n/******/ _N_E = __webpack_exports__;\n/******/ }\n]);"],"names":["self","push","__unused_webpack_module","__unused_webpack_exports","__webpack_require__","window","__NEXT_P","__webpack_exports__","r","Stage","react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__","_fluentui_react__WEBPACK_IMPORTED_MODULE_8__","_fluentui_react__WEBPACK_IMPORTED_MODULE_9__","_fluentui_react__WEBPACK_IMPORTED_MODULE_10__","_yume_chan_adb__WEBPACK_IMPORTED_MODULE_1__","_yume_chan_stream_extra__WEBPACK_IMPORTED_MODULE_2__","mobx__WEBPACK_IMPORTED_MODULE_7__","mobx_react_lite__WEBPACK_IMPORTED_MODULE_3__","next_head__WEBPACK_IMPORTED_MODULE_4__","next_head__WEBPACK_IMPORTED_MODULE_4___default","n","_state__WEBPACK_IMPORTED_MODULE_5__","_utils__WEBPACK_IMPORTED_MODULE_6__","state","constructor","installing","progress","undefined","install","file","oT","accept","z","filename","name","stage","Uploading","uploadedSize","totalSize","size","value","Xd","pipeThrough","Cc","j4","hK","aD","uploaded","Installing","pipeTo","q","device","Completed","ky","LO","ref","Install","jsxs","K","LE","children","jsx","horizontal","a","disabled","text","onClick","Y","styles","root","width","label","percentComplete","description","Pi","O","s","_N_E"],"sourceRoot":""}